import{I as Nr,g as Nm,s as ho,f as vt,t as ct,a as sh,c as F,x as nh,r as oh,H as xm,b as ah,d as au,e as Tm,q as us,h as Dm,i as $m,R as Fm,j as Pt,k as cu,l as hs,m as Um,n as jm,o as lo,p as gs,u as ch,L as Mm,v as Y,w as ci,y as qm,z as uu,A as Lm,B as km,J as Yt,C as po,D as fo,E as go,N as yo,F as Bt,G as Ut,K as vo,M as uh,O as zm,P as Vm,Q as hu,_ as Km}from"./index-f4b9899e.js";function Hm(a,i=[]){const r=[];return Object.keys(a).forEach(n=>{if(i.length&&!i.includes(n))return;const o=a[n];r.push(...o.accounts)}),r}const Bm={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Wm(a,i){const{message:r,code:n}=Bm[a];return{message:i?`${r} ${i}`:r,code:n}}function Qn(a,i){return Array.isArray(a)?typeof i<"u"&&a.length?a.every(i):!0:!1}class Gm extends Nr{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class Jm extends Nr{constructor(i,r){super(),this.core=i,this.logger=r,this.records=new Map}}class Ym{constructor(i,r){this.logger=i,this.core=r}}let Zm=class extends Nr{constructor(i,r){super(),this.relayer=i,this.logger=r}},Qm=class extends Nr{constructor(i){super()}},Xm=class{constructor(i,r,n,o){this.core=i,this.logger=r,this.name=n}};class ew extends Nr{constructor(i,r){super(),this.relayer=i,this.logger=r}}let tw=class extends Nr{constructor(i,r){super(),this.core=i,this.logger=r}},rw=class{constructor(i,r){this.projectId=i,this.logger=r}},iw=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}},sw=class{constructor(i){this.client=i}};function hh(a,i){return a.includes(":")?[a]:i.chains||[]}const lh="base10",qe="base16",Xn="base64pad",mo="utf8",ph=0,ur=1,nw=0,lu=1,eo=12,wo=32;function ow(){const a=nh.generateKeyPair();return{privateKey:ct(a.secretKey,qe),publicKey:ct(a.publicKey,qe)}}function to(){const a=oh.randomBytes(wo);return ct(a,qe)}function aw(a,i){const r=nh.sharedKey(vt(a,qe),vt(i,qe)),n=new xm(ho.SHA256,r).expand(wo);return ct(n,qe)}function cw(a){const i=ho.hash(vt(a,qe));return ct(i,qe)}function Ar(a){const i=ho.hash(vt(a,mo));return ct(i,qe)}function uw(a){return vt(`${a}`,lh)}function ui(a){return Number(ct(a,lh))}function hw(a){const i=uw(typeof a.type<"u"?a.type:ph);if(ui(i)===ur&&typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof a.senderPublicKey<"u"?vt(a.senderPublicKey,qe):void 0,n=typeof a.iv<"u"?vt(a.iv,qe):oh.randomBytes(eo),o=new ah.ChaCha20Poly1305(vt(a.symKey,qe)).seal(n,vt(a.message,mo));return pw({type:i,sealed:o,iv:n,senderPublicKey:r})}function lw(a){const i=new ah.ChaCha20Poly1305(vt(a.symKey,qe)),{sealed:r,iv:n}=ls(a.encoded),o=i.open(n,r);if(o===null)throw new Error("Failed to decrypt");return ct(o,mo)}function pw(a){if(ui(a.type)===ur){if(typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ct(au([a.type,a.senderPublicKey,a.iv,a.sealed]),Xn)}return ct(au([a.type,a.iv,a.sealed]),Xn)}function ls(a){const i=vt(a,Xn),r=i.slice(nw,lu),n=lu;if(ui(r)===ur){const y=n+wo,b=y+eo,C=i.slice(n,y),D=i.slice(y,b),x=i.slice(b);return{type:r,sealed:x,iv:D,senderPublicKey:C}}const o=n+eo,h=i.slice(n,o),d=i.slice(o);return{type:r,sealed:d,iv:h}}function dw(a,i){const r=ls(a);return dh({type:ui(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ct(r.senderPublicKey,qe):void 0,receiverPublicKey:i==null?void 0:i.receiverPublicKey})}function dh(a){const i=(a==null?void 0:a.type)||ph;if(i===ur){if(typeof(a==null?void 0:a.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(a==null?void 0:a.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:i,senderPublicKey:a==null?void 0:a.senderPublicKey,receiverPublicKey:a==null?void 0:a.receiverPublicKey}}function pu(a){return a.type===ur&&typeof a.senderPublicKey=="string"&&typeof a.receiverPublicKey=="string"}var fw=Object.defineProperty,du=Object.getOwnPropertySymbols,gw=Object.prototype.hasOwnProperty,yw=Object.prototype.propertyIsEnumerable,fu=(a,i,r)=>i in a?fw(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,gu=(a,i)=>{for(var r in i||(i={}))gw.call(i,r)&&fu(a,r,i[r]);if(du)for(var r of du(i))yw.call(i,r)&&fu(a,r,i[r]);return a};const vw="ReactNative",Gt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},mw="js";function _o(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function fh(){return!Tm()&&!!sh()&&navigator.product===vw}function bo(){return!_o()&&!!sh()}function Eo(){return fh()?Gt.reactNative:_o()?Gt.node:bo()?Gt.browser:Gt.unknown}function ww(a,i){let r=us.parse(a);return r=gu(gu({},r),i),a=us.stringify(r),a}function _w(){return Nm()||{name:"",description:"",url:"",icons:[""]}}function bw(){if(Eo()===Gt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const a=Dm();if(a===null)return"unknown";const i=a.os?a.os.replace(" ","").toLowerCase():"unknown";return a.type==="browser"?[i,a.name,a.version].join("-"):[i,a.version].join("-")}function Ew(){var a;const i=Eo();return i===Gt.browser?[i,((a=$m())==null?void 0:a.host)||"unknown"].join(":"):i}function Iw(a,i,r){const n=bw(),o=Ew();return[[a,i].join("-"),[mw,r].join("-"),n,o].join("/")}function Pw({protocol:a,version:i,relayUrl:r,sdkVersion:n,auth:o,projectId:h,useOnCloseEvent:d}){const y=r.split("?"),b=Iw(a,i,n),C={auth:o,ua:b,projectId:h,useOnCloseEvent:d||void 0},D=ww(y[1]||"",C);return y[0]+"?"+D}function ar(a,i){return a.filter(r=>i.includes(r)).length===a.length}function gh(a){return Object.fromEntries(a.entries())}function yh(a){return new Map(Object.entries(a))}function Or(a=F.FIVE_MINUTES,i){const r=F.toMiliseconds(a||F.FIVE_MINUTES);let n,o,h;return{resolve:d=>{h&&n&&(clearTimeout(h),n(d))},reject:d=>{h&&o&&(clearTimeout(h),o(d))},done:()=>new Promise((d,y)=>{h=setTimeout(()=>{y(new Error(i))},r),n=d,o=y})}}function ps(a,i,r){return new Promise(async(n,o)=>{const h=setTimeout(()=>o(new Error(r)),i);try{const d=await a;n(d)}catch(d){o(d)}clearTimeout(h)})}function vh(a,i){if(typeof i=="string"&&i.startsWith(`${a}:`))return i;if(a.toLowerCase()==="topic"){if(typeof i!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${i}`}else if(a.toLowerCase()==="id"){if(typeof i!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${i}`}throw new Error(`Unknown expirer target type: ${a}`)}function Sw(a){return vh("topic",a)}function Cw(a){return vh("id",a)}function mh(a){const[i,r]=a.split(":"),n={id:void 0,topic:void 0};if(i==="topic"&&typeof r=="string")n.topic=r;else if(i==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${i}:${r}`);return n}function yt(a,i){return F.fromMiliseconds((i||Date.now())+F.toMiliseconds(a))}function Wt(a){return Date.now()>=F.toMiliseconds(a)}function be(a,i){return`${a}${i?`:${i}`:""}`}function zn(a=[],i=[]){return[...new Set([...a,...i])]}async function Ow({id:a,topic:i,wcDeepLink:r}){try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r;let o=n==null?void 0:n.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const h=`${o}/wc?requestId=${a}&sessionTopic=${i}`,d=Eo();d===Gt.browser?h.startsWith("https://")?window.open(h,"_blank","noreferrer noopener"):window.open(h,"_self","noreferrer noopener"):d===Gt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(h)}catch(n){console.error(n)}}const Aw="irn";function ro(a){return(a==null?void 0:a.relay)||{protocol:Aw}}function os(a){const i=Fm[a];if(typeof i>"u")throw new Error(`Relay Protocol not supported: ${a}`);return i}var Rw=Object.defineProperty,yu=Object.getOwnPropertySymbols,Nw=Object.prototype.hasOwnProperty,xw=Object.prototype.propertyIsEnumerable,vu=(a,i,r)=>i in a?Rw(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Tw=(a,i)=>{for(var r in i||(i={}))Nw.call(i,r)&&vu(a,r,i[r]);if(yu)for(var r of yu(i))xw.call(i,r)&&vu(a,r,i[r]);return a};function Dw(a,i="-"){const r={},n="relay"+i;return Object.keys(a).forEach(o=>{if(o.startsWith(n)){const h=o.replace(n,""),d=a[o];r[h]=d}}),r}function $w(a){const i=a.indexOf(":"),r=a.indexOf("?")!==-1?a.indexOf("?"):void 0,n=a.substring(0,i),o=a.substring(i+1,r).split("@"),h=typeof r<"u"?a.substring(r):"",d=us.parse(h);return{protocol:n,topic:Fw(o[0]),version:parseInt(o[1],10),symKey:d.symKey,relay:Dw(d)}}function Fw(a){return a.startsWith("//")?a.substring(2):a}function Uw(a,i="-"){const r="relay",n={};return Object.keys(a).forEach(o=>{const h=r+i+o;a[o]&&(n[h]=a[o])}),n}function jw(a){return`${a.protocol}:${a.topic}@${a.version}?`+us.stringify(Tw({symKey:a.symKey},Uw(a.relay)))}function xr(a){const i=[];return a.forEach(r=>{const[n,o]=r.split(":");i.push(`${n}:${o}`)}),i}function Mw(a){const i=[];return Object.values(a).forEach(r=>{i.push(...xr(r.accounts))}),i}function qw(a,i){const r=[];return Object.values(a).forEach(n=>{xr(n.accounts).includes(i)&&r.push(...n.methods)}),r}function Lw(a,i){const r=[];return Object.values(a).forEach(n=>{xr(n.accounts).includes(i)&&r.push(...n.events)}),r}function kw(a,i){const r=cs(a,i);if(r)throw new Error(r.message);const n={};for(const[o,h]of Object.entries(a))n[o]={methods:h.methods,events:h.events,chains:h.accounts.map(d=>`${d.split(":")[0]}:${d.split(":")[1]}`)};return n}function Io(a){return a.includes(":")}function as(a){return Io(a)?a.split(":")[0]:a}const zw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Vw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function R(a,i){const{message:r,code:n}=Vw[a];return{message:i?`${r} ${i}`:r,code:n}}function Ee(a,i){const{message:r,code:n}=zw[a];return{message:i?`${r} ${i}`:r,code:n}}function cr(a,i){return Array.isArray(a)?typeof i<"u"&&a.length?a.every(i):!0:!1}function Rr(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function Me(a){return typeof a>"u"}function Ce(a,i){return i&&Me(a)?!0:typeof a=="string"&&!!a.trim().length}function Po(a,i){return i&&Me(a)?!0:typeof a=="number"&&!isNaN(a)}function Kw(a,i){const{requiredNamespaces:r}=i,n=Object.keys(a.namespaces),o=Object.keys(r);let h=!0;return ar(o,n)?(n.forEach(d=>{const{accounts:y,methods:b,events:C}=a.namespaces[d],D=xr(y),x=r[d];(!ar(hh(d,x),D)||!ar(x.methods,b)||!ar(x.events,C))&&(h=!1)}),h):!1}function ds(a){return Ce(a,!1)&&a.includes(":")?a.split(":").length===2:!1}function Hw(a){if(Ce(a,!1)&&a.includes(":")){const i=a.split(":");if(i.length===3){const r=i[0]+":"+i[1];return!!i[2]&&ds(r)}}return!1}function Bw(a){if(Ce(a,!1))try{return typeof new URL(a)<"u"}catch{return!1}return!1}function Ww(a){var i;return(i=a==null?void 0:a.proposer)==null?void 0:i.publicKey}function Gw(a){return a==null?void 0:a.topic}function Jw(a,i){let r=null;return Ce(a==null?void 0:a.publicKey,!1)||(r=R("MISSING_OR_INVALID",`${i} controller public key should be a string`)),r}function mu(a){let i=!0;return cr(a)?a.length&&(i=a.every(r=>Ce(r,!1))):i=!1,i}function Yw(a,i,r){let n=null;return cr(i)&&i.length?i.forEach(o=>{n||ds(o)||(n=Ee("UNSUPPORTED_CHAINS",`${r}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):ds(a)||(n=Ee("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function Zw(a,i,r){let n=null;return Object.entries(a).forEach(([o,h])=>{if(n)return;const d=Yw(o,hh(o,h),`${i} ${r}`);d&&(n=d)}),n}function Qw(a,i){let r=null;return cr(a)?a.forEach(n=>{r||Hw(n)||(r=Ee("UNSUPPORTED_ACCOUNTS",`${i}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=Ee("UNSUPPORTED_ACCOUNTS",`${i}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Xw(a,i){let r=null;return Object.values(a).forEach(n=>{if(r)return;const o=Qw(n==null?void 0:n.accounts,`${i} namespace`);o&&(r=o)}),r}function e1(a,i){let r=null;return mu(a==null?void 0:a.methods)?mu(a==null?void 0:a.events)||(r=Ee("UNSUPPORTED_EVENTS",`${i}, events should be an array of strings or empty array for no events`)):r=Ee("UNSUPPORTED_METHODS",`${i}, methods should be an array of strings or empty array for no methods`),r}function wh(a,i){let r=null;return Object.values(a).forEach(n=>{if(r)return;const o=e1(n,`${i}, namespace`);o&&(r=o)}),r}function t1(a,i,r){let n=null;if(a&&Rr(a)){const o=wh(a,i);o&&(n=o);const h=Zw(a,i,r);h&&(n=h)}else n=R("MISSING_OR_INVALID",`${i}, ${r} should be an object with data`);return n}function cs(a,i){let r=null;if(a&&Rr(a)){const n=wh(a,i);n&&(r=n);const o=Xw(a,i);o&&(r=o)}else r=R("MISSING_OR_INVALID",`${i}, namespaces should be an object with data`);return r}function _h(a){return Ce(a.protocol,!0)}function r1(a,i){let r=!1;return i&&!a?r=!0:a&&cr(a)&&a.length&&a.forEach(n=>{r=_h(n)}),r}function i1(a){return typeof a=="number"}function Ke(a){return typeof a<"u"&&typeof a!==null}function s1(a){return!(!a||typeof a!="object"||!a.code||!Po(a.code,!1)||!a.message||!Ce(a.message,!1))}function n1(a){return!(Me(a)||!Ce(a.method,!1))}function o1(a){return!(Me(a)||Me(a.result)&&Me(a.error)||!Po(a.id,!1)||!Ce(a.jsonrpc,!1))}function a1(a){return!(Me(a)||!Ce(a.name,!1))}function wu(a,i){return!(!ds(i)||!Mw(a).includes(i))}function c1(a,i,r){return Ce(r,!1)?qw(a,i).includes(r):!1}function u1(a,i,r){return Ce(r,!1)?Lw(a,i).includes(r):!1}function _u(a,i,r){let n=null;const o=h1(a),h=l1(i),d=Object.keys(o),y=Object.keys(h),b=bu(Object.keys(a)),C=bu(Object.keys(i)),D=b.filter(x=>!C.includes(x));return D.length&&(n=R("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${D.toString()}
      Received: ${Object.keys(i).toString()}`)),ar(d,y)||(n=R("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${d.toString()}
      Approved: ${y.toString()}`)),Object.keys(i).forEach(x=>{if(!x.includes(":")||n)return;const q=xr(i[x].accounts);q.includes(x)||(n=R("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${x}
        Required: ${x}
        Approved: ${q.toString()}`))}),d.forEach(x=>{n||(ar(o[x].methods,h[x].methods)?ar(o[x].events,h[x].events)||(n=R("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${x}`)):n=R("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${x}`))}),n}function h1(a){const i={};return Object.keys(a).forEach(r=>{var n;r.includes(":")?i[r]=a[r]:(n=a[r].chains)==null||n.forEach(o=>{i[o]={methods:a[r].methods,events:a[r].events}})}),i}function bu(a){return[...new Set(a.map(i=>i.includes(":")?i.split(":")[0]:i))]}function l1(a){const i={};return Object.keys(a).forEach(r=>{if(r.includes(":"))i[r]=a[r];else{const n=xr(a[r].accounts);n==null||n.forEach(o=>{i[o]={accounts:a[r].accounts.filter(h=>h.includes(`${o}:`)),methods:a[r].methods,events:a[r].events}})}}),i}function p1(a,i){return Po(a,!1)&&a<=i.max&&a>=i.min}const d1=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),f1=()=>typeof window<"u",Eu=a=>a.split("?")[0],Iu=10,g1=d1();class y1{constructor(i){if(this.url=i,this.events=new Pt.EventEmitter,this.registering=!1,!cu(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),i()},this.socket.close()})}async send(i,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(hs(i))}catch(n){this.onError(i.id,n)}}register(i=this.url){if(!cu(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=i,this.registering=!0,new Promise((r,n)=>{const o=Um.isReactNative()?void 0:{rejectUnauthorized:!jm(i)},h=new g1(i,[],o);f1()?h.onerror=d=>{const y=d;n(this.emitError(y.error))}:h.on("error",d=>{n(this.emitError(d))}),h.onopen=()=>{this.onOpen(h),r(h)}})}onOpen(i){i.onmessage=r=>this.onPayload(r),i.onclose=r=>this.onClose(r),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?lo(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const n=this.parseError(r),o=n.message||n.toString(),h=gs(i,o);this.events.emit("payload",h)}parseError(i,r=this.url){return ch(i,Eu(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Iu&&this.events.setMaxListeners(Iu)}emitError(i){const r=this.parseError(new Error((i==null?void 0:i.message)||`WebSocket connection failed for host: ${Eu(this.url)}`));return this.events.emit("register_error",r),r}}function v1(a,i){if(a.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<a.length;o++){var h=a.charAt(o),d=h.charCodeAt(0);if(r[d]!==255)throw new TypeError(h+" is ambiguous");r[d]=o}var y=a.length,b=a.charAt(0),C=Math.log(y)/Math.log(256),D=Math.log(256)/Math.log(y);function x(T){if(T instanceof Uint8Array||(ArrayBuffer.isView(T)?T=new Uint8Array(T.buffer,T.byteOffset,T.byteLength):Array.isArray(T)&&(T=Uint8Array.from(T))),!(T instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(T.length===0)return"";for(var te=0,se=0,ae=0,Oe=T.length;ae!==Oe&&T[ae]===0;)ae++,te++;for(var X=(Oe-ae)*D+1>>>0,J=new Uint8Array(X);ae!==Oe;){for(var ne=T[ae],Ae=0,de=X-1;(ne!==0||Ae<se)&&de!==-1;de--,Ae++)ne+=256*J[de]>>>0,J[de]=ne%y>>>0,ne=ne/y>>>0;if(ne!==0)throw new Error("Non-zero carry");se=Ae,ae++}for(var fe=X-se;fe!==X&&J[fe]===0;)fe++;for(var mt=b.repeat(te);fe<X;++fe)mt+=a.charAt(J[fe]);return mt}function q(T){if(typeof T!="string")throw new TypeError("Expected String");if(T.length===0)return new Uint8Array;var te=0;if(T[te]!==" "){for(var se=0,ae=0;T[te]===b;)se++,te++;for(var Oe=(T.length-te)*C+1>>>0,X=new Uint8Array(Oe);T[te];){var J=r[T.charCodeAt(te)];if(J===255)return;for(var ne=0,Ae=Oe-1;(J!==0||ne<ae)&&Ae!==-1;Ae--,ne++)J+=y*X[Ae]>>>0,X[Ae]=J%256>>>0,J=J/256>>>0;if(J!==0)throw new Error("Non-zero carry");ae=ne,te++}if(T[te]!==" "){for(var de=Oe-ae;de!==Oe&&X[de]===0;)de++;for(var fe=new Uint8Array(se+(Oe-de)),mt=se;de!==Oe;)fe[mt++]=X[de++];return fe}}}function Z(T){var te=q(T);if(te)return te;throw new Error(`Non-${i} character`)}return{encode:x,decodeUnsafe:q,decode:Z}}var m1=v1,w1=m1;const bh=a=>{if(a instanceof Uint8Array&&a.constructor.name==="Uint8Array")return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw new Error("Unknown type, must be binary type")},_1=a=>new TextEncoder().encode(a),b1=a=>new TextDecoder().decode(a);class E1{constructor(i,r,n){this.name=i,this.prefix=r,this.baseEncode=n}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class I1{constructor(i,r,n){if(this.name=i,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return Eh(this,i)}}class P1{constructor(i){this.decoders=i}or(i){return Eh(this,i)}decode(i){const r=i[0],n=this.decoders[r];if(n)return n.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Eh=(a,i)=>new P1({...a.decoders||{[a.prefix]:a},...i.decoders||{[i.prefix]:i}});class S1{constructor(i,r,n,o){this.name=i,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new E1(i,r,n),this.decoder=new I1(i,r,o)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const ys=({name:a,prefix:i,encode:r,decode:n})=>new S1(a,i,r,n),hi=({prefix:a,name:i,alphabet:r})=>{const{encode:n,decode:o}=w1(r,i);return ys({prefix:a,name:i,encode:n,decode:h=>bh(o(h))})},C1=(a,i,r,n)=>{const o={};for(let D=0;D<i.length;++D)o[i[D]]=D;let h=a.length;for(;a[h-1]==="=";)--h;const d=new Uint8Array(h*r/8|0);let y=0,b=0,C=0;for(let D=0;D<h;++D){const x=o[a[D]];if(x===void 0)throw new SyntaxError(`Non-${n} character`);b=b<<r|x,y+=r,y>=8&&(y-=8,d[C++]=255&b>>y)}if(y>=r||255&b<<8-y)throw new SyntaxError("Unexpected end of data");return d},O1=(a,i,r)=>{const n=i[i.length-1]==="=",o=(1<<r)-1;let h="",d=0,y=0;for(let b=0;b<a.length;++b)for(y=y<<8|a[b],d+=8;d>r;)d-=r,h+=i[o&y>>d];if(d&&(h+=i[o&y<<r-d]),n)for(;h.length*r&7;)h+="=";return h},xe=({name:a,prefix:i,bitsPerChar:r,alphabet:n})=>ys({prefix:i,name:a,encode(o){return O1(o,n,r)},decode(o){return C1(o,n,r,a)}}),A1=ys({prefix:"\0",name:"identity",encode:a=>b1(a),decode:a=>_1(a)});var R1=Object.freeze({__proto__:null,identity:A1});const N1=xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var x1=Object.freeze({__proto__:null,base2:N1});const T1=xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var D1=Object.freeze({__proto__:null,base8:T1});const $1=hi({prefix:"9",name:"base10",alphabet:"0123456789"});var F1=Object.freeze({__proto__:null,base10:$1});const U1=xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),j1=xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var M1=Object.freeze({__proto__:null,base16:U1,base16upper:j1});const q1=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),L1=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),k1=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),z1=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),V1=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),K1=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),H1=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),B1=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),W1=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var G1=Object.freeze({__proto__:null,base32:q1,base32upper:L1,base32pad:k1,base32padupper:z1,base32hex:V1,base32hexupper:K1,base32hexpad:H1,base32hexpadupper:B1,base32z:W1});const J1=hi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Y1=hi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Z1=Object.freeze({__proto__:null,base36:J1,base36upper:Y1});const Q1=hi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),X1=hi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var e0=Object.freeze({__proto__:null,base58btc:Q1,base58flickr:X1});const t0=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),r0=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),i0=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),s0=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var n0=Object.freeze({__proto__:null,base64:t0,base64pad:r0,base64url:i0,base64urlpad:s0});const Ih=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),o0=Ih.reduce((a,i,r)=>(a[r]=i,a),[]),a0=Ih.reduce((a,i,r)=>(a[i.codePointAt(0)]=r,a),[]);function c0(a){return a.reduce((i,r)=>(i+=o0[r],i),"")}function u0(a){const i=[];for(const r of a){const n=a0[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);i.push(n)}return new Uint8Array(i)}const h0=ys({prefix:"🚀",name:"base256emoji",encode:c0,decode:u0});var l0=Object.freeze({__proto__:null,base256emoji:h0}),p0=Ph,Pu=128,d0=127,f0=~d0,g0=Math.pow(2,31);function Ph(a,i,r){i=i||[],r=r||0;for(var n=r;a>=g0;)i[r++]=a&255|Pu,a/=128;for(;a&f0;)i[r++]=a&255|Pu,a>>>=7;return i[r]=a|0,Ph.bytes=r-n+1,i}var y0=io,v0=128,Su=127;function io(a,n){var r=0,n=n||0,o=0,h=n,d,y=a.length;do{if(h>=y)throw io.bytes=0,new RangeError("Could not decode varint");d=a[h++],r+=o<28?(d&Su)<<o:(d&Su)*Math.pow(2,o),o+=7}while(d>=v0);return io.bytes=h-n,r}var m0=Math.pow(2,7),w0=Math.pow(2,14),_0=Math.pow(2,21),b0=Math.pow(2,28),E0=Math.pow(2,35),I0=Math.pow(2,42),P0=Math.pow(2,49),S0=Math.pow(2,56),C0=Math.pow(2,63),O0=function(a){return a<m0?1:a<w0?2:a<_0?3:a<b0?4:a<E0?5:a<I0?6:a<P0?7:a<S0?8:a<C0?9:10},A0={encode:p0,decode:y0,encodingLength:O0},Sh=A0;const Cu=(a,i,r=0)=>(Sh.encode(a,i,r),i),Ou=a=>Sh.encodingLength(a),so=(a,i)=>{const r=i.byteLength,n=Ou(a),o=n+Ou(r),h=new Uint8Array(o+r);return Cu(a,h,0),Cu(r,h,n),h.set(i,o),new R0(a,r,i,h)};class R0{constructor(i,r,n,o){this.code=i,this.size=r,this.digest=n,this.bytes=o}}const Ch=({name:a,code:i,encode:r})=>new N0(a,i,r);class N0{constructor(i,r,n){this.name=i,this.code=r,this.encode=n}digest(i){if(i instanceof Uint8Array){const r=this.encode(i);return r instanceof Uint8Array?so(this.code,r):r.then(n=>so(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Oh=a=>async i=>new Uint8Array(await crypto.subtle.digest(a,i)),x0=Ch({name:"sha2-256",code:18,encode:Oh("SHA-256")}),T0=Ch({name:"sha2-512",code:19,encode:Oh("SHA-512")});var D0=Object.freeze({__proto__:null,sha256:x0,sha512:T0});const Ah=0,$0="identity",Rh=bh,F0=a=>so(Ah,Rh(a)),U0={code:Ah,name:$0,encode:Rh,digest:F0};var j0=Object.freeze({__proto__:null,identity:U0});new TextEncoder,new TextDecoder;const Au={...R1,...x1,...D1,...F1,...M1,...G1,...Z1,...e0,...n0,...l0};({...D0,...j0});function Nh(a){return globalThis.Buffer!=null?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function M0(a=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Nh(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function xh(a,i,r,n){return{name:a,prefix:i,encoder:{name:a,prefix:i,encode:r},decoder:{decode:n}}}const Ru=xh("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),Vn=xh("ascii","a",a=>{let i="a";for(let r=0;r<a.length;r++)i+=String.fromCharCode(a[r]);return i},a=>{a=a.substring(1);const i=M0(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);return i}),q0={utf8:Ru,"utf-8":Ru,hex:Au.base16,latin1:Vn,ascii:Vn,binary:Vn,...Au};function L0(a,i="utf8"){const r=q0[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Nh(globalThis.Buffer.from(a,"utf-8")):r.decoder.decode(`${r.prefix}${a}`)}const Th="wc",k0=2,So="core",Jt=`${Th}@2:${So}:`,z0={name:So,logger:"error"},V0={database:":memory:"},K0="crypto",Nu="client_ed25519_seed",H0=F.ONE_DAY,B0="keychain",W0="0.3",G0="messages",J0="0.3",Y0=F.SIX_HOURS,Z0="publisher",Dh="irn",Q0="error",$h="wss://relay.walletconnect.com",xu="wss://relay.walletconnect.org",X0="relayer",ve={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},e_="_subscription",ri={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},t_=F.ONE_SECOND/2,r_="2.9.0",i_=1e4,s_="0.3",n_="WALLETCONNECT_CLIENT_ID",It={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},o_="subscription",a_="0.3",c_=F.FIVE_SECONDS*1e3,u_="pairing",h_="0.3",ii={wc_pairingDelete:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:F.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:F.ONE_DAY,prompt:!1,tag:0},res:{ttl:F.ONE_DAY,prompt:!1,tag:0}}},Et={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},l_="history",p_="0.3",d_="expirer",at={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},f_="0.3",Kn="verify-api",Tu="https://verify.walletconnect.com";class g_{constructor(i,r){this.core=i,this.logger=r,this.keychain=new Map,this.name=B0,this.version=W0,this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:h}=R("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=i,this.logger=Y.generateChildLogger(r,this.name)}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,gh(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?yh(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class y_{constructor(i,r,n){this.core=i,this.logger=r,this.name=K0,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=uu(o);return Lm(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=ow();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),d=uu(h),y=to();return await km(y,o,H0,d)},this.generateSharedKey=(o,h,d)=>{this.isInitialized();const y=this.getPrivateKey(o),b=aw(y,h);return this.setSymKey(b,d)},this.setSymKey=async(o,h)=>{this.isInitialized();const d=h||cw(o);return await this.keychain.set(d,o),d},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,d)=>{this.isInitialized();const y=dh(d),b=hs(h);if(pu(y)){const q=y.senderPublicKey,Z=y.receiverPublicKey;o=await this.generateSharedKey(q,Z)}const C=this.getSymKey(o),{type:D,senderPublicKey:x}=y;return hw({type:D,symKey:C,message:b,senderPublicKey:x})},this.decode=async(o,h,d)=>{this.isInitialized();const y=dw(h,d);if(pu(y)){const D=y.receiverPublicKey,x=y.senderPublicKey;o=await this.generateSharedKey(D,x)}const b=this.getSymKey(o),C=lw({symKey:b,encoded:h});return lo(C)},this.getPayloadType=o=>{const h=ls(o);return ui(h.type)},this.getPayloadSenderPublicKey=o=>{const h=ls(o);return h.senderPublicKey?ct(h.senderPublicKey,qe):void 0},this.core=i,this.logger=Y.generateChildLogger(r,this.name),this.keychain=n||new g_(this.core,this.logger)}get context(){return Y.getLoggerContext(this.logger)}async setPrivateKey(i,r){return await this.keychain.set(i,r),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(Nu)}catch{i=to(),await this.keychain.set(Nu,i)}return L0(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class v_ extends Ym{constructor(i,r){super(i,r),this.logger=i,this.core=r,this.messages=new Map,this.name=G0,this.version=J0,this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const h=Ar(o);let d=this.messages.get(n);return typeof d>"u"&&(d={}),typeof d[h]<"u"||(d[h]=o,this.messages.set(n,d),await this.persist()),h},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const h=this.get(n),d=Ar(o);return typeof h[d]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Y.generateChildLogger(i,this.name),this.core=r}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,gh(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?yh(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class m_ extends Zm{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.events=new Pt.EventEmitter,this.name=Z0,this.queue=new Map,this.publishTimeout=F.toMiliseconds(F.TEN_SECONDS),this.queueTimeout=F.toMiliseconds(F.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,h)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}});try{const d=(h==null?void 0:h.ttl)||Y0,y=ro(h),b=(h==null?void 0:h.prompt)||!1,C=(h==null?void 0:h.tag)||0,D=(h==null?void 0:h.id)||uh().toString(),x={topic:n,message:o,opts:{ttl:d,relay:y,prompt:b,tag:C,id:D}},q=setTimeout(()=>this.queue.set(D,x),this.queueTimeout);try{await await ps(this.rpcPublish(n,o,d,y,b,C,D),this.publishTimeout),clearTimeout(q),this.relayer.events.emit(ve.publish,x)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=i,this.logger=Y.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Y.getLoggerContext(this.logger)}rpcPublish(i,r,n,o,h,d,y){var b,C,D,x;const q={method:os(o.protocol).publish,params:{topic:i,message:r,ttl:n,prompt:h,tag:d},id:y};return Me((b=q.params)==null?void 0:b.prompt)&&((C=q.params)==null||delete C.prompt),Me((D=q.params)==null?void 0:D.tag)&&((x=q.params)==null||delete x.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:q}),this.relayer.request(q)}onPublish(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:r,message:n,opts:o}=i;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(ci.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ve.connection_stalled);return}this.checkQueue()}),this.relayer.on(ve.message_ack,i=>{this.onPublish(i.id.toString())})}}class w_{constructor(){this.map=new Map,this.set=(i,r)=>{const n=this.get(i);this.exists(i,r)||this.map.set(i,[...n,r])},this.get=i=>this.map.get(i)||[],this.exists=(i,r)=>this.get(i).includes(r),this.delete=(i,r)=>{if(typeof r>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const n=this.get(i);if(!this.exists(i,r))return;const o=n.filter(h=>h!==r);if(!o.length){this.map.delete(i);return}this.map.set(i,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var __=Object.defineProperty,b_=Object.defineProperties,E_=Object.getOwnPropertyDescriptors,Du=Object.getOwnPropertySymbols,I_=Object.prototype.hasOwnProperty,P_=Object.prototype.propertyIsEnumerable,$u=(a,i,r)=>i in a?__(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,si=(a,i)=>{for(var r in i||(i={}))I_.call(i,r)&&$u(a,r,i[r]);if(Du)for(var r of Du(i))P_.call(i,r)&&$u(a,r,i[r]);return a},Hn=(a,i)=>b_(a,E_(i));class S_ extends ew{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.subscriptions=new Map,this.topicMap=new w_,this.events=new Pt.EventEmitter,this.name=o_,this.version=a_,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Jt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const h=ro(o),d={topic:n,relay:h};this.pending.set(n,d);const y=await this.rpcSubscribe(n,h);return this.onSubscribe(y,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),y}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,h)=>{const d=new F.Watch;d.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(y),d.stop(this.pendingSubscriptionWatchLabel),o(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=c_&&(clearInterval(y),d.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=Y.generateChildLogger(r,this.name),this.clientId=""}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,r){let n=!1;try{n=this.getSubscription(i).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,r){const n=this.topicMap.get(i);await Promise.all(n.map(async o=>await this.unsubscribeById(i,o,r)))}async unsubscribeById(i,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:n}});try{const o=ro(n);await this.rpcUnsubscribe(i,r,o);const h=Ee("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,r,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(i,r){const n={method:os(r.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await ps(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ve.connection_stalled)}return Ar(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const r=i[0].relay,n={method:os(r.protocol).batchSubscribe,params:{topics:i.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await ps(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(ve.connection_stalled)}}rpcUnsubscribe(i,r,n){const o={method:os(n.protocol).unsubscribe,params:{topic:i,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(i,r){this.setSubscription(i,Hn(si({},r),{id:i})),this.pending.delete(r.topic)}onBatchSubscribe(i){i.length&&i.forEach(r=>{this.setSubscription(r.id,si({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(i,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,i)&&this.deleteSubscription(r,n),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,r){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:r}),this.addSubscription(i,r))}addSubscription(i,r){this.subscriptions.set(i,si({},r)),this.topicMap.set(r.topic,i),this.events.emit(It.created,r)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const r=this.subscriptions.get(i);if(!r){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}deleteSubscription(i,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:r});const n=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(n.topic,i),this.events.emit(It.deleted,Hn(si({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(It.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(It.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:r}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const r=await this.rpcBatchSubscribe(i);cr(r)&&this.onBatchSubscribe(r.map((n,o)=>Hn(si({},i[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(r=>{i.push(r)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(ci.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(ve.connect,async()=>{await this.onConnect()}),this.relayer.on(ve.disconnect,()=>{this.onDisconnect()}),this.events.on(It.created,async i=>{const r=It.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()}),this.events.on(It.deleted,async i=>{const r=It.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),i())},this.pollingInterval)})}}var C_=Object.defineProperty,Fu=Object.getOwnPropertySymbols,O_=Object.prototype.hasOwnProperty,A_=Object.prototype.propertyIsEnumerable,Uu=(a,i,r)=>i in a?C_(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,R_=(a,i)=>{for(var r in i||(i={}))O_.call(i,r)&&Uu(a,r,i[r]);if(Fu)for(var r of Fu(i))A_.call(i,r)&&Uu(a,r,i[r]);return a};class N_ extends Qm{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new Pt.EventEmitter,this.name=X0,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?Y.generateChildLogger(i.logger,this.name):Y.pino(Y.getDefaultLoggerOptions({level:i.logger||Q0})),this.messages=new v_(this.logger,i.core),this.subscriber=new S_(this,this.logger),this.publisher=new m_(this,this.logger),this.relayUrl=(i==null?void 0:i.relayUrl)||$h,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${xu}...`),await this.restartTransport(xu)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},i_)}get context(){return Y.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,r,n){this.isInitialized(),await this.publisher.publish(i,r,n),await this.recordMessageEvent({topic:i,message:r,publishedAt:Date.now()})}async subscribe(i,r){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(i))==null?void 0:n[0])||"";return o||(await Promise.all([new Promise(h=>{this.subscriber.once(It.created,d=>{d.topic===i&&h()})}),new Promise(async h=>{o=await this.subscriber.subscribe(i,r),h()})]),o)}async unsubscribe(i,r){this.isInitialized(),await this.subscriber.unsubscribe(i,r)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(ve.transport_closed))}async transportOpen(i){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=i||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(It.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,n)=>{await ps(this.provider.connect(),5e3,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>n(o)).then(()=>r()).finally(()=>this.removeListener(ve.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(ve.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.events.emit(ve.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(i){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=i||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once(ri.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(i){return this.staleConnectionErrors.some(r=>i.includes(r))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Yt(new y1(Pw({sdkVersion:r_,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:r,message:n}=i;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(i){const{topic:r,message:n}=i;return await this.subscriber.isSubscribed(r)?this.messages.has(r,n):!0}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),po(i)){if(!i.method.endsWith(e_))return;const r=i.params,{topic:n,message:o,publishedAt:h}=r.data,d={topic:n,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(R_({type:"event",event:r.id},d)),this.events.emit(r.id,d),await this.acknowledgePayload(i),await this.onMessageEvent(d)}else fo(i)&&this.events.emit(ve.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(ve.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const r=go(i.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on(ri.payload,i=>this.onProviderPayload(i)),this.provider.on(ri.connect,()=>{this.events.emit(ve.connect)}),this.provider.on(ri.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(ri.error,i=>{this.logger.error(i),this.events.emit(ve.error,i)})}registerEventListeners(){this.events.on(ve.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(ve.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},F.toMiliseconds(t_))}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(i=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var x_=Object.defineProperty,ju=Object.getOwnPropertySymbols,T_=Object.prototype.hasOwnProperty,D_=Object.prototype.propertyIsEnumerable,Mu=(a,i,r)=>i in a?x_(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,qu=(a,i)=>{for(var r in i||(i={}))T_.call(i,r)&&Mu(a,r,i[r]);if(ju)for(var r of ju(i))D_.call(i,r)&&Mu(a,r,i[r]);return a};class vs extends Xm{constructor(i,r,n,o=Jt,h=void 0){super(i,r,n,o),this.core=i,this.logger=r,this.name=n,this.map=new Map,this.version=s_,this.cached=[],this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!Me(d)?this.map.set(this.getKey(d),d):Ww(d)?this.map.set(d.id,d):Gw(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,y)=>{this.isInitialized(),this.map.has(d)?await this.update(d,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:y}),this.map.set(d,y),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(y=>Object.keys(d).every(b=>Mm(y[b],d[b]))):this.values),this.update=async(d,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:y});const b=qu(qu({},this.getData(d)),y);this.map.set(d,b),await this.persist()},this.delete=async(d,y)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:y}),this.map.delete(d),await this.persist())},this.logger=Y.generateChildLogger(r,this.name),this.storagePrefix=o,this.getKey=h}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const r=this.map.get(i);if(!r){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:r}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class $_{constructor(i,r){this.core=i,this.logger=r,this.name=u_,this.version=h_,this.events=new yo,this.initialized=!1,this.storagePrefix=Jt,this.ignoredPayloadTypes=[ur],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=to(),o=await this.core.crypto.setSymKey(n),h=yt(F.FIVE_MINUTES),d={protocol:Dh},y={topic:o,expiry:h,relay:d,active:!1},b=jw({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:d});return await this.pairings.set(o,y),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:b}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:h,relay:d}=$w(n.uri);if(this.pairings.keys.includes(o))throw new Error(`Pairing already exists: ${o}`);if(this.core.crypto.hasKeys(o))throw new Error(`Keychain already exists: ${o}`);const y=yt(F.FIVE_MINUTES),b={topic:o,relay:d,expiry:y,active:!1};return await this.pairings.set(o,b),await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:d}),this.core.expirer.set(o,y),n.activatePairing&&await this.activate({topic:o}),b},this.activate=async({topic:n})=>{this.isInitialized();const o=yt(F.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:d,resolve:y,reject:b}=Or();this.events.once(be("pairing_ping",h),({error:C})=>{C?b(C):y()}),await d()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",Ee("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,h)=>{const d=vo(o,h),y=await this.core.crypto.encode(n,d),b=ii[o].req;return this.core.history.set(n,d),this.core.relayer.publish(n,y,b),d.id},this.sendResult=async(n,o,h)=>{const d=go(n,h),y=await this.core.crypto.encode(o,d),b=await this.core.history.get(o,n),C=ii[b.request.method].res;await this.core.relayer.publish(o,y,C),await this.core.history.resolve(d)},this.sendError=async(n,o,h)=>{const d=gs(n,h),y=await this.core.crypto.encode(o,d),b=await this.core.history.get(o,n),C=ii[b.request.method]?ii[b.request.method].res:ii.unregistered_method.res;await this.core.relayer.publish(o,y,C),await this.core.history.resolve(d)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Ee("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Wt(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:h}=n,d=h.method;if(this.pairings.keys.includes(o))switch(d){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:h}=n,d=(await this.core.history.get(o,h.id)).request.method;if(this.pairings.keys.includes(o))switch(d){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(n,o)=>{const{id:h}=o;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit("pairing_ping",{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onPairingPingResponse=(n,o)=>{const{id:h}=o;setTimeout(()=>{Bt(o)?this.events.emit(be("pairing_ping",h),{}):Ut(o)&&this.events.emit(be("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit("pairing_delete",{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:h,method:d}=o;try{if(this.registeredMethods.includes(d))return;const y=Ee("WC_METHOD_UNSUPPORTED",d);await this.sendError(h,n,y),this.logger.error(y)}catch(y){await this.sendError(h,n,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(Ee("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!Ke(n)){const{message:o}=R("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(o)}if(!Bw(n.uri)){const{message:o}=R("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(o)}},this.isValidPing=async n=>{if(!Ke(n)){const{message:h}=R("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Ke(n)){const{message:h}=R("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!Ce(n,!1)){const{message:o}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Wt(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=R("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=i,this.logger=Y.generateChildLogger(r,this.name),this.pairings=new vs(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Y.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(ve.message,async i=>{const{topic:r,message:n}=i;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);po(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):fo(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))})}registerExpirerEvents(){this.core.expirer.on(at.expired,async i=>{const{topic:r}=mh(i.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class F_ extends Jm{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.records=new Map,this.events=new Pt.EventEmitter,this.name=l_,this.version=p_,this.cached=[],this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:h}),this.records.has(o.id))return;const d={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:h,expiry:yt(F.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(Et.created,d)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=Ut(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(Et.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===n){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(Et.deleted,h)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Y.generateChildLogger(r,this.name)}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:vo(r.request.method,r.request.params,r.id),chainId:r.chainId};return i.push(n)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const r=this.records.get(i);if(!r){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Et.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:r}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(Et.created,i=>{const r=Et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(Et.updated,i=>{const r=Et.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(Et.deleted,i=>{const r=Et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.core.heartbeat.on(ci.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{F.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class U_ extends tw{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.expirations=new Map,this.events=new Pt.EventEmitter,this.name=d_,this.version=f_,this.cached=[],this.initialized=!1,this.storagePrefix=Jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const h=this.formatTarget(n),d={target:h,expiry:o};this.expirations.set(h,d),this.checkExpiry(h,d),this.events.emit(at.created,{target:h,expiration:d})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(at.deleted,{target:o,expiration:h})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Y.generateChildLogger(r,this.name)}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return Sw(i);if(typeof i=="number")return Cw(i);const{message:r}=R("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(r)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(at.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:r}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const r=this.expirations.get(i);if(!r){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(i,r){const{expiry:n}=r;F.toMiliseconds(n)-Date.now()<=0&&this.expire(i,r)}expire(i,r){this.expirations.delete(i),this.events.emit(at.expired,{target:i,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,r)=>this.checkExpiry(r,i))}registerEventListeners(){this.core.heartbeat.on(ci.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(at.created,i=>{const r=at.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(at.expired,i=>{const r=at.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(at.deleted,i=>{const r=at.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class j_ extends rw{constructor(i,r){super(i,r),this.projectId=i,this.logger=r,this.name=Kn,this.initialized=!1,this.init=async n=>{fh()||!bo()||(this.verifyUrl=(n==null?void 0:n.verifyUrl)||Tu,await this.createIframe())},this.register=async n=>{var o;if(this.initialized||await this.init(),!!this.iframe)try{(o=this.iframe.contentWindow)==null||o.postMessage(n.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${n.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async n=>{var o;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${n.attestationId}`);const h=this.startAbortTimer(F.FIVE_SECONDS),d=await fetch(`${this.verifyUrl}/attestation/${n.attestationId}`,{signal:this.abortController.signal});return clearTimeout(h),d.status===200?(o=await d.json())==null?void 0:o.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((n,o)=>{if(document.getElementById(Kn))return n();const h=document.createElement("iframe");h.setAttribute("id",Kn),h.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),h.style.display="none",h.addEventListener("load",()=>{this.initialized=!0,n()}),h.addEventListener("error",d=>{o(d)}),document.body.append(h),this.iframe=h}),new Promise(n=>{setTimeout(()=>n("iframe load timeout"),F.toMiliseconds(F.ONE_SECOND/2))})])}catch(n){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(n)}},this.logger=Y.generateChildLogger(r,this.name),this.verifyUrl=Tu,this.abortController=new AbortController,this.isDevEnv=_o()&&{}.IS_VITEST}get context(){return Y.getLoggerContext(this.logger)}startAbortTimer(i){return setTimeout(()=>this.abortController.abort(),F.toMiliseconds(i))}}var M_=Object.defineProperty,Lu=Object.getOwnPropertySymbols,q_=Object.prototype.hasOwnProperty,L_=Object.prototype.propertyIsEnumerable,ku=(a,i,r)=>i in a?M_(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,zu=(a,i)=>{for(var r in i||(i={}))q_.call(i,r)&&ku(a,r,i[r]);if(Lu)for(var r of Lu(i))L_.call(i,r)&&ku(a,r,i[r]);return a};class Co extends Gm{constructor(i){super(i),this.protocol=Th,this.version=k0,this.name=So,this.events=new Pt.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=i==null?void 0:i.projectId,this.relayUrl=(i==null?void 0:i.relayUrl)||$h;const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Y.pino(Y.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||z0.logger}));this.logger=Y.generateChildLogger(r,this.name),this.heartbeat=new ci.HeartBeat,this.crypto=new y_(this,this.logger,i==null?void 0:i.keychain),this.history=new F_(this,this.logger),this.expirer=new U_(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new qm(zu(zu({},V0),i==null?void 0:i.storageOptions)),this.relayer=new N_({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new $_(this,this.logger),this.verify=new j_(this.projectId||"",this.logger)}static async init(i){const r=new Co(i);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(n_,n),r}get context(){return Y.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const k_=Co,Fh="wc",Uh=2,jh="client",Oo=`${Fh}@${Uh}:${jh}:`,Bn={name:jh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},z_="WALLETCONNECT_DEEPLINK_CHOICE",V_="proposal",Mh="Proposal expired",K_="session",is=F.SEVEN_DAYS,H_="engine",ni={wc_sessionPropose:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1104},res:{ttl:F.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1106},res:{ttl:F.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1112},res:{ttl:F.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1115}}},Wn={min:F.FIVE_MINUTES,max:F.SEVEN_DAYS},B_="request",W_=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var G_=Object.defineProperty,J_=Object.defineProperties,Y_=Object.getOwnPropertyDescriptors,Vu=Object.getOwnPropertySymbols,Z_=Object.prototype.hasOwnProperty,Q_=Object.prototype.propertyIsEnumerable,Ku=(a,i,r)=>i in a?G_(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,ot=(a,i)=>{for(var r in i||(i={}))Z_.call(i,r)&&Ku(a,r,i[r]);if(Vu)for(var r of Vu(i))Q_.call(i,r)&&Ku(a,r,i[r]);return a},Gn=(a,i)=>J_(a,Y_(i));class X_ extends sw{constructor(i){super(i),this.name=H_,this.events=new yo,this.initialized=!1,this.ignoredPayloadTypes=[ur],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(ni)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized();const n=Gn(ot({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:d,sessionProperties:y,relays:b}=n;let C=o,D,x=!1;if(C&&(x=this.client.core.pairing.pairings.get(C).active),!C||!x){const{topic:X,uri:J}=await this.client.core.pairing.create();C=X,D=J}const q=await this.client.core.crypto.generateKeyPair(),Z=ot({requiredNamespaces:h,optionalNamespaces:d,relays:b??[{protocol:Dh}],proposer:{publicKey:q,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:T,resolve:te,done:se}=Or(F.FIVE_MINUTES,Mh);if(this.events.once(be("session_connect"),async({error:X,session:J})=>{if(X)T(X);else if(J){J.self.publicKey=q;const ne=Gn(ot({},J),{requiredNamespaces:J.requiredNamespaces,optionalNamespaces:J.optionalNamespaces});await this.client.session.set(J.topic,ne),await this.setExpiry(J.topic,J.expiry),C&&await this.client.core.pairing.updateMetadata({topic:C,metadata:J.peer.metadata}),te(ne)}}),!C){const{message:X}=R("NO_MATCHING_KEY",`connect() pairing topic: ${C}`);throw new Error(X)}const ae=await this.sendRequest(C,"wc_sessionPropose",Z),Oe=yt(F.FIVE_MINUTES);return await this.setProposal(ae,ot({id:ae,expiry:Oe},Z)),{uri:D,approval:se}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:h,sessionProperties:d}=r,y=this.client.proposal.get(n);let{pairingTopic:b,proposer:C,requiredNamespaces:D,optionalNamespaces:x}=y;b=b||"",Rr(D)||(D=kw(h,"approve()"));const q=await this.client.core.crypto.generateKeyPair(),Z=C.publicKey,T=await this.client.core.crypto.generateSharedKey(q,Z);b&&n&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:C.metadata}),await this.sendResult(n,b,{relay:{protocol:o??"irn"},responderPublicKey:q}),await this.client.proposal.delete(n,Ee("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const te=ot({relay:{protocol:o??"irn"},namespaces:h,requiredNamespaces:D,optionalNamespaces:x,pairingTopic:b,controller:{publicKey:q,metadata:this.client.metadata},expiry:yt(is)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(T),await this.sendRequest(T,"wc_sessionSettle",te);const se=Gn(ot({},te),{topic:T,pairingTopic:b,acknowledged:!1,self:te.controller,peer:{publicKey:C.publicKey,metadata:C.metadata},controller:q});return await this.client.session.set(T,se),await this.setExpiry(T,yt(is)),{topic:T,acknowledged:()=>new Promise(ae=>setTimeout(()=>ae(this.client.session.get(T)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,o),await this.client.proposal.delete(n,Ee("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,h=await this.sendRequest(n,"wc_sessionUpdate",{namespaces:o}),{done:d,resolve:y,reject:b}=Or();return this.events.once(be("session_update",h),({error:C})=>{C?b(C):y()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:d}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest(n,"wc_sessionExtend",{}),{done:h,resolve:d,reject:y}=Or();return this.events.once(be("session_extend",o),({error:b})=>{b?y(b):d()}),await this.setExpiry(n,yt(is)),{acknowledged:h}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:h,expiry:d}=r,y=await this.sendRequest(h,"wc_sessionRequest",{request:o,chainId:n},d),{done:b,resolve:C,reject:D}=Or(d);this.events.once(be("session_request",y),({error:q,result:Z})=>{q?D(q):C(Z)}),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:n,id:y});const x=await this.client.core.storage.getItem(z_);return Ow({id:y,topic:h,wcDeepLink:x}),await b()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:h}=o;Bt(o)?await this.sendResult(h,n,o.result):Ut(o)&&await this.sendError(h,n,o.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest(n,"wc_sessionPing",{}),{done:h,resolve:d,reject:y}=Or();this.events.once(be("session_ping",o),({error:b})=>{b?y(b):d()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:h}=r;await this.sendRequest(n,"wc_sessionEvent",{event:o,chainId:h})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=uh().toString();let h;const d=y=>{(y==null?void 0:y.id.toString())===o&&(this.client.core.relayer.events.removeListener(ve.message_ack,d),h())};await Promise.all([new Promise(y=>{h=y,this.client.core.relayer.on(ve.message_ack,d)}),this.sendRequest(n,"wc_sessionDelete",Ee("USER_DISCONNECTED"),void 0,o)]),await this.deleteSession(n)}else await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>Kw(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var d,y;return((d=h.peerMetadata)==null?void 0:d.url)&&((y=h.peerMetadata)==null?void 0:y.url)===r.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Ee("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r)},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,Ee("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=ni.wc_sessionRequest.req.ttl,{id:o,topic:h,params:d}=r;await this.client.pendingRequest.set(o,{id:o,topic:h,params:d}),n&&this.client.core.expirer.set(o,yt(n))},this.sendRequest=async(r,n,o,h,d)=>{const y=vo(n,o);if(bo()&&W_.includes(n)){const D=Ar(JSON.stringify(y));await this.client.core.verify.register({attestationId:D})}const b=await this.client.core.crypto.encode(r,y),C=ni[n].req;return h&&(C.ttl=h),d&&(C.id=d),this.client.core.history.set(r,y),this.client.core.relayer.publish(r,b,C),y.id},this.sendResult=async(r,n,o)=>{const h=go(r,o),d=await this.client.core.crypto.encode(n,h),y=await this.client.core.history.get(n,r),b=ni[y.request.method].res;this.client.core.relayer.publish(n,d,b),await this.client.core.history.resolve(h)},this.sendError=async(r,n,o)=>{const h=gs(r,o),d=await this.client.core.crypto.encode(n,h),y=await this.client.core.history.get(n,r),b=ni[y.request.method].res;this.client.core.relayer.publish(n,d,b),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{Wt(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Wt(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=r=>{const{topic:n,payload:o}=r,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,h=(await this.client.core.history.get(n,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:o}=R("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:h}=n;try{this.isValidConnect(ot({},n.params));const d=yt(F.FIVE_MINUTES),y=ot({id:h,pairingTopic:r,expiry:d},o);await this.setProposal(h,y);const b=Ar(JSON.stringify(n)),C=await this.getVerifyContext(b,y.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:y,verifyContext:C})}catch(d){await this.sendError(h,r,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(Bt(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const d=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const y=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const b=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const C=await this.client.core.crypto.generateSharedKey(y,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:C});const D=await this.client.core.relayer.subscribe(C);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:D}),await this.client.core.pairing.activate({topic:r})}else Ut(n)&&(await this.client.proposal.delete(o,Ee("USER_DISCONNECTED")),this.events.emit(be("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:d,controller:y,expiry:b,namespaces:C,requiredNamespaces:D,optionalNamespaces:x,sessionProperties:q,pairingTopic:Z}=n.params,T=ot({topic:r,relay:d,expiry:b,namespaces:C,acknowledged:!0,pairingTopic:Z,requiredNamespaces:D,optionalNamespaces:x,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},q&&{sessionProperties:q});await this.sendResult(n.id,r,!0),this.events.emit(be("session_connect"),{session:T}),this.cleanupDuplicatePairings(T)}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;Bt(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(be("session_approve",o),{})):Ut(n)&&(await this.client.session.delete(r,Ee("USER_DISCONNECTED")),this.events.emit(be("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:h}=n;try{this.isValidUpdate(ot({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult(h,r,!0),this.client.events.emit("session_update",{id:h,topic:r,params:o})}catch(d){await this.sendError(h,r,d),this.client.logger.error(d)}},this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;Bt(n)?this.events.emit(be("session_update",o),{}):Ut(n)&&this.events.emit(be("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,yt(is)),await this.sendResult(o,r,!0),this.client.events.emit("session_extend",{id:o,topic:r})}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;Bt(n)?this.events.emit(be("session_extend",o),{}):Ut(n)&&this.events.emit(be("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult(o,r,!0),this.client.events.emit("session_ping",{id:o,topic:r})}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{Bt(n)?this.events.emit(be("session_ping",o),{}):Ut(n)&&this.events.emit(be("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(ve.publish,async()=>{h(await this.deleteSession(r))})}),this.sendResult(o,r,!0)]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:h}=n;try{this.isValidRequest(ot({topic:r},h)),await this.setPendingSessionRequest({id:o,topic:r,params:h});const d=Ar(JSON.stringify(n)),y=this.client.session.get(r),b=await this.getVerifyContext(d,y.peer.metadata);this.client.events.emit("session_request",{id:o,topic:r,params:h,verifyContext:b})}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;Bt(n)?this.events.emit(be("session_request",o),{result:n.result}):Ut(n)&&this.events.emit(be("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:h}=n;try{this.isValidEmit(ot({topic:r},h)),this.client.events.emit("session_event",{id:o,topic:r,params:h})}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.isValidConnect=async r=>{if(!Ke(r)){const{message:b}=R("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(b)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:d,relays:y}=r;if(Me(n)||await this.isValidPairingTopic(n),!r1(y,!0)){const{message:b}=R("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(b)}!Me(o)&&Rr(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Me(h)&&Rr(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),Me(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=t1(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!Ke(r))throw new Error(R("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:h,sessionProperties:d}=r;await this.isValidProposalId(n);const y=this.client.proposal.get(n),b=cs(o,"approve()");if(b)throw new Error(b.message);const C=_u(y.requiredNamespaces,o,"approve()");if(C)throw new Error(C.message);if(!Ce(h,!0)){const{message:D}=R("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(D)}Me(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async r=>{if(!Ke(r)){const{message:h}=R("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(h)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!s1(o)){const{message:h}=R("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=r=>{if(!Ke(r)){const{message:C}=R("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(C)}const{relay:n,controller:o,namespaces:h,expiry:d}=r;if(!_h(n)){const{message:C}=R("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(C)}const y=Jw(o,"onSessionSettleRequest()");if(y)throw new Error(y.message);const b=cs(h,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(Wt(d)){const{message:C}=R("EXPIRED","onSessionSettleRequest()");throw new Error(C)}},this.isValidUpdate=async r=>{if(!Ke(r)){const{message:b}=R("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(b)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const h=this.client.session.get(n),d=cs(o,"update()");if(d)throw new Error(d.message);const y=_u(h.requiredNamespaces,o,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!Ke(r)){const{message:o}=R("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!Ke(r)){const{message:b}=R("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(b)}const{topic:n,request:o,chainId:h,expiry:d}=r;await this.isValidSessionTopic(n);const{namespaces:y}=this.client.session.get(n);if(!wu(y,h)){const{message:b}=R("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(b)}if(!n1(o)){const{message:b}=R("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(b)}if(!c1(y,h,o.method)){const{message:b}=R("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(b)}if(d&&!p1(d,Wn)){const{message:b}=R("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${Wn.min} and ${Wn.max}`);throw new Error(b)}},this.isValidRespond=async r=>{if(!Ke(r)){const{message:h}=R("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:n,response:o}=r;if(await this.isValidSessionTopic(n),!o1(o)){const{message:h}=R("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!Ke(r)){const{message:o}=R("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!Ke(r)){const{message:y}=R("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:n,event:o,chainId:h}=r;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!wu(d,h)){const{message:y}=R("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(y)}if(!a1(o)){const{message:y}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}if(!u1(d,h,o.name)){const{message:y}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!Ke(r)){const{message:o}=R("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||"",validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});h&&(o.verified.origin=h,o.verified.validation=h===n.url?"VALID":"INVALID")}catch(h){this.client.logger.error(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!Ce(o,!1)){const{message:h}=R("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.client.core.relayer.on(ve.message,async i=>{const{topic:r,message:n}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);po(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):fo(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})})}registerExpirerEvents(){this.client.core.expirer.on(at.expired,async i=>{const{topic:r,id:n}=mh(i.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,R("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}isValidPairingTopic(i){if(!Ce(i,!1)){const{message:r}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:r}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(Wt(this.client.core.pairing.pairings.get(i).expiry)){const{message:r}=R("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}}async isValidSessionTopic(i){if(!Ce(i,!1)){const{message:r}=R("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(r)}if(!this.client.session.keys.includes(i)){const{message:r}=R("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(r)}if(Wt(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:r}=R("EXPIRED",`session topic: ${i}`);throw new Error(r)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(Ce(i,!1)){const{message:r}=R("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(r)}else{const{message:r}=R("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(r)}}async isValidProposalId(i){if(!i1(i)){const{message:r}=R("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(r)}if(!this.client.proposal.keys.includes(i)){const{message:r}=R("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(r)}if(Wt(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:r}=R("EXPIRED",`proposal id: ${i}`);throw new Error(r)}}}class eb extends vs{constructor(i,r){super(i,r,V_,Oo),this.core=i,this.logger=r}}class tb extends vs{constructor(i,r){super(i,r,K_,Oo),this.core=i,this.logger=r}}class rb extends vs{constructor(i,r){super(i,r,B_,Oo,n=>n.id),this.core=i,this.logger=r}}let ib=class qh extends iw{constructor(i){super(i),this.protocol=Fh,this.version=Uh,this.name=Bn.name,this.events=new Pt.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(i==null?void 0:i.name)||Bn.name,this.metadata=(i==null?void 0:i.metadata)||_w();const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Y.pino(Y.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Bn.logger}));this.core=(i==null?void 0:i.core)||new k_(i),this.logger=Y.generateChildLogger(r,this.name),this.session=new tb(this.core,this.logger),this.proposal=new eb(this.core,this.logger),this.pendingRequest=new rb(this.core,this.logger),this.engine=new X_(this)}static async init(i){const r=new qh(i);return await r.initialize(),r}get context(){return Y.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};var no={exports:{}};(function(a,i){var r=typeof self<"u"?self:zm,n=function(){function h(){this.fetch=!1,this.DOMException=r.DOMException}return h.prototype=r,new h}();(function(h){(function(d){var y={searchParams:"URLSearchParams"in h,iterable:"Symbol"in h&&"iterator"in Symbol,blob:"FileReader"in h&&"Blob"in h&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in h,arrayBuffer:"ArrayBuffer"in h};function b(_){return _&&DataView.prototype.isPrototypeOf(_)}if(y.arrayBuffer)var C=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],D=ArrayBuffer.isView||function(_){return _&&C.indexOf(Object.prototype.toString.call(_))>-1};function x(_){if(typeof _!="string"&&(_=String(_)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(_))throw new TypeError("Invalid character in header field name");return _.toLowerCase()}function q(_){return typeof _!="string"&&(_=String(_)),_}function Z(_){var O={next:function(){var V=_.shift();return{done:V===void 0,value:V}}};return y.iterable&&(O[Symbol.iterator]=function(){return O}),O}function T(_){this.map={},_ instanceof T?_.forEach(function(O,V){this.append(V,O)},this):Array.isArray(_)?_.forEach(function(O){this.append(O[0],O[1])},this):_&&Object.getOwnPropertyNames(_).forEach(function(O){this.append(O,_[O])},this)}T.prototype.append=function(_,O){_=x(_),O=q(O);var V=this.map[_];this.map[_]=V?V+", "+O:O},T.prototype.delete=function(_){delete this.map[x(_)]},T.prototype.get=function(_){return _=x(_),this.has(_)?this.map[_]:null},T.prototype.has=function(_){return this.map.hasOwnProperty(x(_))},T.prototype.set=function(_,O){this.map[x(_)]=q(O)},T.prototype.forEach=function(_,O){for(var V in this.map)this.map.hasOwnProperty(V)&&_.call(O,this.map[V],V,this)},T.prototype.keys=function(){var _=[];return this.forEach(function(O,V){_.push(V)}),Z(_)},T.prototype.values=function(){var _=[];return this.forEach(function(O){_.push(O)}),Z(_)},T.prototype.entries=function(){var _=[];return this.forEach(function(O,V){_.push([V,O])}),Z(_)},y.iterable&&(T.prototype[Symbol.iterator]=T.prototype.entries);function te(_){if(_.bodyUsed)return Promise.reject(new TypeError("Already read"));_.bodyUsed=!0}function se(_){return new Promise(function(O,V){_.onload=function(){O(_.result)},_.onerror=function(){V(_.error)}})}function ae(_){var O=new FileReader,V=se(O);return O.readAsArrayBuffer(_),V}function Oe(_){var O=new FileReader,V=se(O);return O.readAsText(_),V}function X(_){for(var O=new Uint8Array(_),V=new Array(O.length),le=0;le<O.length;le++)V[le]=String.fromCharCode(O[le]);return V.join("")}function J(_){if(_.slice)return _.slice(0);var O=new Uint8Array(_.byteLength);return O.set(new Uint8Array(_)),O.buffer}function ne(){return this.bodyUsed=!1,this._initBody=function(_){this._bodyInit=_,_?typeof _=="string"?this._bodyText=_:y.blob&&Blob.prototype.isPrototypeOf(_)?this._bodyBlob=_:y.formData&&FormData.prototype.isPrototypeOf(_)?this._bodyFormData=_:y.searchParams&&URLSearchParams.prototype.isPrototypeOf(_)?this._bodyText=_.toString():y.arrayBuffer&&y.blob&&b(_)?(this._bodyArrayBuffer=J(_.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):y.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(_)||D(_))?this._bodyArrayBuffer=J(_):this._bodyText=_=Object.prototype.toString.call(_):this._bodyText="",this.headers.get("content-type")||(typeof _=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(_)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var _=te(this);if(_)return _;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?te(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(ae)}),this.text=function(){var _=te(this);if(_)return _;if(this._bodyBlob)return Oe(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(X(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(mt)}),this.json=function(){return this.text().then(JSON.parse)},this}var Ae=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function de(_){var O=_.toUpperCase();return Ae.indexOf(O)>-1?O:_}function fe(_,O){O=O||{};var V=O.body;if(_ instanceof fe){if(_.bodyUsed)throw new TypeError("Already read");this.url=_.url,this.credentials=_.credentials,O.headers||(this.headers=new T(_.headers)),this.method=_.method,this.mode=_.mode,this.signal=_.signal,!V&&_._bodyInit!=null&&(V=_._bodyInit,_.bodyUsed=!0)}else this.url=String(_);if(this.credentials=O.credentials||this.credentials||"same-origin",(O.headers||!this.headers)&&(this.headers=new T(O.headers)),this.method=de(O.method||this.method||"GET"),this.mode=O.mode||this.mode||null,this.signal=O.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&V)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(V)}fe.prototype.clone=function(){return new fe(this,{body:this._bodyInit})};function mt(_){var O=new FormData;return _.trim().split("&").forEach(function(V){if(V){var le=V.split("="),ce=le.shift().replace(/\+/g," "),re=le.join("=").replace(/\+/g," ");O.append(decodeURIComponent(ce),decodeURIComponent(re))}}),O}function ms(_){var O=new T,V=_.replace(/\r?\n[\t ]+/g," ");return V.split(/\r?\n/).forEach(function(le){var ce=le.split(":"),re=ce.shift().trim();if(re){var St=ce.join(":").trim();O.append(re,St)}}),O}ne.call(fe.prototype);function Ze(_,O){O||(O={}),this.type="default",this.status=O.status===void 0?200:O.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in O?O.statusText:"OK",this.headers=new T(O.headers),this.url=O.url||"",this._initBody(_)}ne.call(Ze.prototype),Ze.prototype.clone=function(){return new Ze(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new T(this.headers),url:this.url})},Ze.error=function(){var _=new Ze(null,{status:0,statusText:""});return _.type="error",_};var ws=[301,302,303,307,308];Ze.redirect=function(_,O){if(ws.indexOf(O)===-1)throw new RangeError("Invalid status code");return new Ze(null,{status:O,headers:{location:_}})},d.DOMException=h.DOMException;try{new d.DOMException}catch{d.DOMException=function(O,V){this.message=O,this.name=V;var le=Error(O);this.stack=le.stack},d.DOMException.prototype=Object.create(Error.prototype),d.DOMException.prototype.constructor=d.DOMException}function Tr(_,O){return new Promise(function(V,le){var ce=new fe(_,O);if(ce.signal&&ce.signal.aborted)return le(new d.DOMException("Aborted","AbortError"));var re=new XMLHttpRequest;function St(){re.abort()}re.onload=function(){var Te={status:re.status,statusText:re.statusText,headers:ms(re.getAllResponseHeaders()||"")};Te.url="responseURL"in re?re.responseURL:Te.headers.get("X-Request-URL");var Dr="response"in re?re.response:re.responseText;V(new Ze(Dr,Te))},re.onerror=function(){le(new TypeError("Network request failed"))},re.ontimeout=function(){le(new TypeError("Network request failed"))},re.onabort=function(){le(new d.DOMException("Aborted","AbortError"))},re.open(ce.method,ce.url,!0),ce.credentials==="include"?re.withCredentials=!0:ce.credentials==="omit"&&(re.withCredentials=!1),"responseType"in re&&y.blob&&(re.responseType="blob"),ce.headers.forEach(function(Te,Dr){re.setRequestHeader(Dr,Te)}),ce.signal&&(ce.signal.addEventListener("abort",St),re.onreadystatechange=function(){re.readyState===4&&ce.signal.removeEventListener("abort",St)}),re.send(typeof ce._bodyInit>"u"?null:ce._bodyInit)})}return Tr.polyfill=!0,h.fetch||(h.fetch=Tr,h.Headers=T,h.Request=fe,h.Response=Ze),d.Headers=T,d.Request=fe,d.Response=Ze,d.fetch=Tr,Object.defineProperty(d,"__esModule",{value:!0}),d})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;i=o.fetch,i.default=o.fetch,i.fetch=o.fetch,i.Headers=o.Headers,i.Request=o.Request,i.Response=o.Response,a.exports=i})(no,no.exports);var sb=no.exports;const Hu=Vm(sb),nb={Accept:"application/json","Content-Type":"application/json"},ob="POST",Bu={headers:nb,method:ob},Wu=10;class hr{constructor(i,r=!1){if(this.url=i,this.disableProviderPing=r,this.events=new Pt.EventEmitter,this.isAvailable=!1,this.registering=!1,!hu(i))throw new Error(`Provided URL is not compatible with HTTP connection: ${i}`);this.url=i,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(i,r){this.isAvailable||await this.register();try{const n=hs(i),h=await(await Hu(this.url,Object.assign(Object.assign({},Bu),{body:n}))).json();this.onPayload({data:h})}catch(n){this.onError(i.id,n)}}async register(i=this.url){if(!hu(i))throw new Error(`Provided URL is not compatible with HTTP connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=i,this.registering=!0;try{if(!this.disableProviderPing){const r=hs({id:1,jsonrpc:"2.0",method:"test",params:[]});await Hu(i,Object.assign(Object.assign({},Bu),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?lo(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const n=this.parseError(r),o=n.message||n.toString(),h=gs(i,o);this.events.emit("payload",h)}parseError(i,r=this.url){return ch(i,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Wu&&this.events.setMaxListeners(Wu)}}const Gu="error",ab="wss://relay.walletconnect.com",cb="wc",ub="universal_provider",Ju=`${cb}@2:${ub}:`,hb="https://rpc.walletconnect.com/v1",Zt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var oi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oo={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(a,i){(function(){var r,n="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",y="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",C=500,D="__lodash_placeholder__",x=1,q=2,Z=4,T=1,te=2,se=1,ae=2,Oe=4,X=8,J=16,ne=32,Ae=64,de=128,fe=256,mt=512,ms=30,Ze="...",ws=800,Tr=16,_=1,O=2,V=3,le=1/0,ce=9007199254740991,re=17976931348623157e292,St=0/0,Te=4294967295,Dr=Te-1,zh=Te>>>1,Vh=[["ary",de],["bind",se],["bindKey",ae],["curry",X],["curryRight",J],["flip",mt],["partial",ne],["partialRight",Ae],["rearg",fe]],lr="[object Arguments]",li="[object Array]",Kh="[object AsyncFunction]",$r="[object Boolean]",Fr="[object Date]",Hh="[object DOMException]",pi="[object Error]",di="[object Function]",No="[object GeneratorFunction]",ht="[object Map]",Ur="[object Number]",Bh="[object Null]",Ct="[object Object]",xo="[object Promise]",Wh="[object Proxy]",jr="[object RegExp]",lt="[object Set]",Mr="[object String]",fi="[object Symbol]",Gh="[object Undefined]",qr="[object WeakMap]",Jh="[object WeakSet]",Lr="[object ArrayBuffer]",pr="[object DataView]",_s="[object Float32Array]",bs="[object Float64Array]",Es="[object Int8Array]",Is="[object Int16Array]",Ps="[object Int32Array]",Ss="[object Uint8Array]",Cs="[object Uint8ClampedArray]",Os="[object Uint16Array]",As="[object Uint32Array]",Yh=/\b__p \+= '';/g,Zh=/\b(__p \+=) '' \+/g,Qh=/(__e\(.*?\)|\b__t\)) \+\n'';/g,To=/&(?:amp|lt|gt|quot|#39);/g,Do=/[&<>"']/g,Xh=RegExp(To.source),el=RegExp(Do.source),tl=/<%-([\s\S]+?)%>/g,rl=/<%([\s\S]+?)%>/g,$o=/<%=([\s\S]+?)%>/g,il=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,sl=/^\w*$/,nl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Rs=/[\\^$.*+?()[\]{}|]/g,ol=RegExp(Rs.source),Ns=/^\s+/,al=/\s/,cl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ul=/\{\n\/\* \[wrapped with (.+)\] \*/,hl=/,? & /,ll=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pl=/[()=,{}\[\]\/\s]/,dl=/\\(\\)?/g,fl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Fo=/\w*$/,gl=/^[-+]0x[0-9a-f]+$/i,yl=/^0b[01]+$/i,vl=/^\[object .+?Constructor\]$/,ml=/^0o[0-7]+$/i,wl=/^(?:0|[1-9]\d*)$/,_l=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,gi=/($^)/,bl=/['\n\r\u2028\u2029\\]/g,yi="\\ud800-\\udfff",El="\\u0300-\\u036f",Il="\\ufe20-\\ufe2f",Pl="\\u20d0-\\u20ff",Uo=El+Il+Pl,jo="\\u2700-\\u27bf",Mo="a-z\\xdf-\\xf6\\xf8-\\xff",Sl="\\xac\\xb1\\xd7\\xf7",Cl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ol="\\u2000-\\u206f",Al=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",qo="A-Z\\xc0-\\xd6\\xd8-\\xde",Lo="\\ufe0e\\ufe0f",ko=Sl+Cl+Ol+Al,xs="['’]",Rl="["+yi+"]",zo="["+ko+"]",vi="["+Uo+"]",Vo="\\d+",Nl="["+jo+"]",Ko="["+Mo+"]",Ho="[^"+yi+ko+Vo+jo+Mo+qo+"]",Ts="\\ud83c[\\udffb-\\udfff]",xl="(?:"+vi+"|"+Ts+")",Bo="[^"+yi+"]",Ds="(?:\\ud83c[\\udde6-\\uddff]){2}",$s="[\\ud800-\\udbff][\\udc00-\\udfff]",dr="["+qo+"]",Wo="\\u200d",Go="(?:"+Ko+"|"+Ho+")",Tl="(?:"+dr+"|"+Ho+")",Jo="(?:"+xs+"(?:d|ll|m|re|s|t|ve))?",Yo="(?:"+xs+"(?:D|LL|M|RE|S|T|VE))?",Zo=xl+"?",Qo="["+Lo+"]?",Dl="(?:"+Wo+"(?:"+[Bo,Ds,$s].join("|")+")"+Qo+Zo+")*",$l="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Fl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Xo=Qo+Zo+Dl,Ul="(?:"+[Nl,Ds,$s].join("|")+")"+Xo,jl="(?:"+[Bo+vi+"?",vi,Ds,$s,Rl].join("|")+")",Ml=RegExp(xs,"g"),ql=RegExp(vi,"g"),Fs=RegExp(Ts+"(?="+Ts+")|"+jl+Xo,"g"),Ll=RegExp([dr+"?"+Ko+"+"+Jo+"(?="+[zo,dr,"$"].join("|")+")",Tl+"+"+Yo+"(?="+[zo,dr+Go,"$"].join("|")+")",dr+"?"+Go+"+"+Jo,dr+"+"+Yo,Fl,$l,Vo,Ul].join("|"),"g"),kl=RegExp("["+Wo+yi+Uo+Lo+"]"),zl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Vl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Kl=-1,he={};he[_s]=he[bs]=he[Es]=he[Is]=he[Ps]=he[Ss]=he[Cs]=he[Os]=he[As]=!0,he[lr]=he[li]=he[Lr]=he[$r]=he[pr]=he[Fr]=he[pi]=he[di]=he[ht]=he[Ur]=he[Ct]=he[jr]=he[lt]=he[Mr]=he[qr]=!1;var ue={};ue[lr]=ue[li]=ue[Lr]=ue[pr]=ue[$r]=ue[Fr]=ue[_s]=ue[bs]=ue[Es]=ue[Is]=ue[Ps]=ue[ht]=ue[Ur]=ue[Ct]=ue[jr]=ue[lt]=ue[Mr]=ue[fi]=ue[Ss]=ue[Cs]=ue[Os]=ue[As]=!0,ue[pi]=ue[di]=ue[qr]=!1;var Hl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Bl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Wl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Gl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Jl=parseFloat,Yl=parseInt,ea=typeof oi=="object"&&oi&&oi.Object===Object&&oi,Zl=typeof self=="object"&&self&&self.Object===Object&&self,Re=ea||Zl||Function("return this")(),Us=i&&!i.nodeType&&i,Qt=Us&&!0&&a&&!a.nodeType&&a,ta=Qt&&Qt.exports===Us,js=ta&&ea.process,Qe=function(){try{var v=Qt&&Qt.require&&Qt.require("util").types;return v||js&&js.binding&&js.binding("util")}catch{}}(),ra=Qe&&Qe.isArrayBuffer,ia=Qe&&Qe.isDate,sa=Qe&&Qe.isMap,na=Qe&&Qe.isRegExp,oa=Qe&&Qe.isSet,aa=Qe&&Qe.isTypedArray;function He(v,E,w){switch(w.length){case 0:return v.call(E);case 1:return v.call(E,w[0]);case 2:return v.call(E,w[0],w[1]);case 3:return v.call(E,w[0],w[1],w[2])}return v.apply(E,w)}function Ql(v,E,w,N){for(var L=-1,Q=v==null?0:v.length;++L<Q;){var Ie=v[L];E(N,Ie,w(Ie),v)}return N}function Xe(v,E){for(var w=-1,N=v==null?0:v.length;++w<N&&E(v[w],w,v)!==!1;);return v}function Xl(v,E){for(var w=v==null?0:v.length;w--&&E(v[w],w,v)!==!1;);return v}function ca(v,E){for(var w=-1,N=v==null?0:v.length;++w<N;)if(!E(v[w],w,v))return!1;return!0}function jt(v,E){for(var w=-1,N=v==null?0:v.length,L=0,Q=[];++w<N;){var Ie=v[w];E(Ie,w,v)&&(Q[L++]=Ie)}return Q}function mi(v,E){var w=v==null?0:v.length;return!!w&&fr(v,E,0)>-1}function Ms(v,E,w){for(var N=-1,L=v==null?0:v.length;++N<L;)if(w(E,v[N]))return!0;return!1}function pe(v,E){for(var w=-1,N=v==null?0:v.length,L=Array(N);++w<N;)L[w]=E(v[w],w,v);return L}function Mt(v,E){for(var w=-1,N=E.length,L=v.length;++w<N;)v[L+w]=E[w];return v}function qs(v,E,w,N){var L=-1,Q=v==null?0:v.length;for(N&&Q&&(w=v[++L]);++L<Q;)w=E(w,v[L],L,v);return w}function ep(v,E,w,N){var L=v==null?0:v.length;for(N&&L&&(w=v[--L]);L--;)w=E(w,v[L],L,v);return w}function Ls(v,E){for(var w=-1,N=v==null?0:v.length;++w<N;)if(E(v[w],w,v))return!0;return!1}var tp=ks("length");function rp(v){return v.split("")}function ip(v){return v.match(ll)||[]}function ua(v,E,w){var N;return w(v,function(L,Q,Ie){if(E(L,Q,Ie))return N=Q,!1}),N}function wi(v,E,w,N){for(var L=v.length,Q=w+(N?1:-1);N?Q--:++Q<L;)if(E(v[Q],Q,v))return Q;return-1}function fr(v,E,w){return E===E?gp(v,E,w):wi(v,ha,w)}function sp(v,E,w,N){for(var L=w-1,Q=v.length;++L<Q;)if(N(v[L],E))return L;return-1}function ha(v){return v!==v}function la(v,E){var w=v==null?0:v.length;return w?Vs(v,E)/w:St}function ks(v){return function(E){return E==null?r:E[v]}}function zs(v){return function(E){return v==null?r:v[E]}}function pa(v,E,w,N,L){return L(v,function(Q,Ie,oe){w=N?(N=!1,Q):E(w,Q,Ie,oe)}),w}function np(v,E){var w=v.length;for(v.sort(E);w--;)v[w]=v[w].value;return v}function Vs(v,E){for(var w,N=-1,L=v.length;++N<L;){var Q=E(v[N]);Q!==r&&(w=w===r?Q:w+Q)}return w}function Ks(v,E){for(var w=-1,N=Array(v);++w<v;)N[w]=E(w);return N}function op(v,E){return pe(E,function(w){return[w,v[w]]})}function da(v){return v&&v.slice(0,va(v)+1).replace(Ns,"")}function Be(v){return function(E){return v(E)}}function Hs(v,E){return pe(E,function(w){return v[w]})}function kr(v,E){return v.has(E)}function fa(v,E){for(var w=-1,N=v.length;++w<N&&fr(E,v[w],0)>-1;);return w}function ga(v,E){for(var w=v.length;w--&&fr(E,v[w],0)>-1;);return w}function ap(v,E){for(var w=v.length,N=0;w--;)v[w]===E&&++N;return N}var cp=zs(Hl),up=zs(Bl);function hp(v){return"\\"+Gl[v]}function lp(v,E){return v==null?r:v[E]}function gr(v){return kl.test(v)}function pp(v){return zl.test(v)}function dp(v){for(var E,w=[];!(E=v.next()).done;)w.push(E.value);return w}function Bs(v){var E=-1,w=Array(v.size);return v.forEach(function(N,L){w[++E]=[L,N]}),w}function ya(v,E){return function(w){return v(E(w))}}function qt(v,E){for(var w=-1,N=v.length,L=0,Q=[];++w<N;){var Ie=v[w];(Ie===E||Ie===D)&&(v[w]=D,Q[L++]=w)}return Q}function _i(v){var E=-1,w=Array(v.size);return v.forEach(function(N){w[++E]=N}),w}function fp(v){var E=-1,w=Array(v.size);return v.forEach(function(N){w[++E]=[N,N]}),w}function gp(v,E,w){for(var N=w-1,L=v.length;++N<L;)if(v[N]===E)return N;return-1}function yp(v,E,w){for(var N=w+1;N--;)if(v[N]===E)return N;return N}function yr(v){return gr(v)?mp(v):tp(v)}function pt(v){return gr(v)?wp(v):rp(v)}function va(v){for(var E=v.length;E--&&al.test(v.charAt(E)););return E}var vp=zs(Wl);function mp(v){for(var E=Fs.lastIndex=0;Fs.test(v);)++E;return E}function wp(v){return v.match(Fs)||[]}function _p(v){return v.match(Ll)||[]}var bp=function v(E){E=E==null?Re:vr.defaults(Re.Object(),E,vr.pick(Re,Vl));var w=E.Array,N=E.Date,L=E.Error,Q=E.Function,Ie=E.Math,oe=E.Object,Ws=E.RegExp,Ep=E.String,et=E.TypeError,bi=w.prototype,Ip=Q.prototype,mr=oe.prototype,Ei=E["__core-js_shared__"],Ii=Ip.toString,ie=mr.hasOwnProperty,Pp=0,ma=function(){var e=/[^.]+$/.exec(Ei&&Ei.keys&&Ei.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Pi=mr.toString,Sp=Ii.call(oe),Cp=Re._,Op=Ws("^"+Ii.call(ie).replace(Rs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Si=ta?E.Buffer:r,Lt=E.Symbol,Ci=E.Uint8Array,wa=Si?Si.allocUnsafe:r,Oi=ya(oe.getPrototypeOf,oe),_a=oe.create,ba=mr.propertyIsEnumerable,Ai=bi.splice,Ea=Lt?Lt.isConcatSpreadable:r,zr=Lt?Lt.iterator:r,Xt=Lt?Lt.toStringTag:r,Ri=function(){try{var e=sr(oe,"defineProperty");return e({},"",{}),e}catch{}}(),Ap=E.clearTimeout!==Re.clearTimeout&&E.clearTimeout,Rp=N&&N.now!==Re.Date.now&&N.now,Np=E.setTimeout!==Re.setTimeout&&E.setTimeout,Ni=Ie.ceil,xi=Ie.floor,Gs=oe.getOwnPropertySymbols,xp=Si?Si.isBuffer:r,Ia=E.isFinite,Tp=bi.join,Dp=ya(oe.keys,oe),Pe=Ie.max,De=Ie.min,$p=N.now,Fp=E.parseInt,Pa=Ie.random,Up=bi.reverse,Js=sr(E,"DataView"),Vr=sr(E,"Map"),Ys=sr(E,"Promise"),wr=sr(E,"Set"),Kr=sr(E,"WeakMap"),Hr=sr(oe,"create"),Ti=Kr&&new Kr,_r={},jp=nr(Js),Mp=nr(Vr),qp=nr(Ys),Lp=nr(wr),kp=nr(Kr),Di=Lt?Lt.prototype:r,Br=Di?Di.valueOf:r,Sa=Di?Di.toString:r;function l(e){if(ye(e)&&!k(e)&&!(e instanceof W)){if(e instanceof tt)return e;if(ie.call(e,"__wrapped__"))return Cc(e)}return new tt(e)}var br=function(){function e(){}return function(t){if(!ge(t))return{};if(_a)return _a(t);e.prototype=t;var s=new e;return e.prototype=r,s}}();function $i(){}function tt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}l.templateSettings={escape:tl,evaluate:rl,interpolate:$o,variable:"",imports:{_:l}},l.prototype=$i.prototype,l.prototype.constructor=l,tt.prototype=br($i.prototype),tt.prototype.constructor=tt;function W(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Te,this.__views__=[]}function zp(){var e=new W(this.__wrapped__);return e.__actions__=Le(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Le(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Le(this.__views__),e}function Vp(){if(this.__filtered__){var e=new W(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Kp(){var e=this.__wrapped__.value(),t=this.__dir__,s=k(e),c=t<0,u=s?e.length:0,p=rf(0,u,this.__views__),f=p.start,g=p.end,m=g-f,I=c?g:f-1,P=this.__iteratees__,S=P.length,A=0,$=De(m,this.__takeCount__);if(!s||!c&&u==m&&$==m)return Ja(e,this.__actions__);var j=[];e:for(;m--&&A<$;){I+=t;for(var K=-1,M=e[I];++K<S;){var B=P[K],G=B.iteratee,Je=B.type,je=G(M);if(Je==O)M=je;else if(!je){if(Je==_)continue e;break e}}j[A++]=M}return j}W.prototype=br($i.prototype),W.prototype.constructor=W;function er(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var c=e[t];this.set(c[0],c[1])}}function Hp(){this.__data__=Hr?Hr(null):{},this.size=0}function Bp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Wp(e){var t=this.__data__;if(Hr){var s=t[e];return s===b?r:s}return ie.call(t,e)?t[e]:r}function Gp(e){var t=this.__data__;return Hr?t[e]!==r:ie.call(t,e)}function Jp(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Hr&&t===r?b:t,this}er.prototype.clear=Hp,er.prototype.delete=Bp,er.prototype.get=Wp,er.prototype.has=Gp,er.prototype.set=Jp;function Ot(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var c=e[t];this.set(c[0],c[1])}}function Yp(){this.__data__=[],this.size=0}function Zp(e){var t=this.__data__,s=Fi(t,e);if(s<0)return!1;var c=t.length-1;return s==c?t.pop():Ai.call(t,s,1),--this.size,!0}function Qp(e){var t=this.__data__,s=Fi(t,e);return s<0?r:t[s][1]}function Xp(e){return Fi(this.__data__,e)>-1}function ed(e,t){var s=this.__data__,c=Fi(s,e);return c<0?(++this.size,s.push([e,t])):s[c][1]=t,this}Ot.prototype.clear=Yp,Ot.prototype.delete=Zp,Ot.prototype.get=Qp,Ot.prototype.has=Xp,Ot.prototype.set=ed;function At(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var c=e[t];this.set(c[0],c[1])}}function td(){this.size=0,this.__data__={hash:new er,map:new(Vr||Ot),string:new er}}function rd(e){var t=Wi(this,e).delete(e);return this.size-=t?1:0,t}function id(e){return Wi(this,e).get(e)}function sd(e){return Wi(this,e).has(e)}function nd(e,t){var s=Wi(this,e),c=s.size;return s.set(e,t),this.size+=s.size==c?0:1,this}At.prototype.clear=td,At.prototype.delete=rd,At.prototype.get=id,At.prototype.has=sd,At.prototype.set=nd;function tr(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new At;++t<s;)this.add(e[t])}function od(e){return this.__data__.set(e,b),this}function ad(e){return this.__data__.has(e)}tr.prototype.add=tr.prototype.push=od,tr.prototype.has=ad;function dt(e){var t=this.__data__=new Ot(e);this.size=t.size}function cd(){this.__data__=new Ot,this.size=0}function ud(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function hd(e){return this.__data__.get(e)}function ld(e){return this.__data__.has(e)}function pd(e,t){var s=this.__data__;if(s instanceof Ot){var c=s.__data__;if(!Vr||c.length<o-1)return c.push([e,t]),this.size=++s.size,this;s=this.__data__=new At(c)}return s.set(e,t),this.size=s.size,this}dt.prototype.clear=cd,dt.prototype.delete=ud,dt.prototype.get=hd,dt.prototype.has=ld,dt.prototype.set=pd;function Ca(e,t){var s=k(e),c=!s&&or(e),u=!s&&!c&&Ht(e),p=!s&&!c&&!u&&Sr(e),f=s||c||u||p,g=f?Ks(e.length,Ep):[],m=g.length;for(var I in e)(t||ie.call(e,I))&&!(f&&(I=="length"||u&&(I=="offset"||I=="parent")||p&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||Tt(I,m)))&&g.push(I);return g}function Oa(e){var t=e.length;return t?e[cn(0,t-1)]:r}function dd(e,t){return Gi(Le(e),rr(t,0,e.length))}function fd(e){return Gi(Le(e))}function Zs(e,t,s){(s!==r&&!ft(e[t],s)||s===r&&!(t in e))&&Rt(e,t,s)}function Wr(e,t,s){var c=e[t];(!(ie.call(e,t)&&ft(c,s))||s===r&&!(t in e))&&Rt(e,t,s)}function Fi(e,t){for(var s=e.length;s--;)if(ft(e[s][0],t))return s;return-1}function gd(e,t,s,c){return kt(e,function(u,p,f){t(c,u,s(u),f)}),c}function Aa(e,t){return e&&_t(t,Se(t),e)}function yd(e,t){return e&&_t(t,ze(t),e)}function Rt(e,t,s){t=="__proto__"&&Ri?Ri(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function Qs(e,t){for(var s=-1,c=t.length,u=w(c),p=e==null;++s<c;)u[s]=p?r:Dn(e,t[s]);return u}function rr(e,t,s){return e===e&&(s!==r&&(e=e<=s?e:s),t!==r&&(e=e>=t?e:t)),e}function rt(e,t,s,c,u,p){var f,g=t&x,m=t&q,I=t&Z;if(s&&(f=u?s(e,c,u,p):s(e)),f!==r)return f;if(!ge(e))return e;var P=k(e);if(P){if(f=nf(e),!g)return Le(e,f)}else{var S=$e(e),A=S==di||S==No;if(Ht(e))return Qa(e,g);if(S==Ct||S==lr||A&&!u){if(f=m||A?{}:vc(e),!g)return m?Wd(e,yd(f,e)):Bd(e,Aa(f,e))}else{if(!ue[S])return u?e:{};f=of(e,S,g)}}p||(p=new dt);var $=p.get(e);if($)return $;p.set(e,f),Bc(e)?e.forEach(function(M){f.add(rt(M,t,s,M,e,p))}):Kc(e)&&e.forEach(function(M,B){f.set(B,rt(M,t,s,B,e,p))});var j=I?m?wn:mn:m?ze:Se,K=P?r:j(e);return Xe(K||e,function(M,B){K&&(B=M,M=e[B]),Wr(f,B,rt(M,t,s,B,e,p))}),f}function vd(e){var t=Se(e);return function(s){return Ra(s,e,t)}}function Ra(e,t,s){var c=s.length;if(e==null)return!c;for(e=oe(e);c--;){var u=s[c],p=t[u],f=e[u];if(f===r&&!(u in e)||!p(f))return!1}return!0}function Na(e,t,s){if(typeof e!="function")throw new et(d);return ei(function(){e.apply(r,s)},t)}function Gr(e,t,s,c){var u=-1,p=mi,f=!0,g=e.length,m=[],I=t.length;if(!g)return m;s&&(t=pe(t,Be(s))),c?(p=Ms,f=!1):t.length>=o&&(p=kr,f=!1,t=new tr(t));e:for(;++u<g;){var P=e[u],S=s==null?P:s(P);if(P=c||P!==0?P:0,f&&S===S){for(var A=I;A--;)if(t[A]===S)continue e;m.push(P)}else p(t,S,c)||m.push(P)}return m}var kt=ic(wt),xa=ic(en,!0);function md(e,t){var s=!0;return kt(e,function(c,u,p){return s=!!t(c,u,p),s}),s}function Ui(e,t,s){for(var c=-1,u=e.length;++c<u;){var p=e[c],f=t(p);if(f!=null&&(g===r?f===f&&!Ge(f):s(f,g)))var g=f,m=p}return m}function wd(e,t,s,c){var u=e.length;for(s=z(s),s<0&&(s=-s>u?0:u+s),c=c===r||c>u?u:z(c),c<0&&(c+=u),c=s>c?0:Gc(c);s<c;)e[s++]=t;return e}function Ta(e,t){var s=[];return kt(e,function(c,u,p){t(c,u,p)&&s.push(c)}),s}function Ne(e,t,s,c,u){var p=-1,f=e.length;for(s||(s=cf),u||(u=[]);++p<f;){var g=e[p];t>0&&s(g)?t>1?Ne(g,t-1,s,c,u):Mt(u,g):c||(u[u.length]=g)}return u}var Xs=sc(),Da=sc(!0);function wt(e,t){return e&&Xs(e,t,Se)}function en(e,t){return e&&Da(e,t,Se)}function ji(e,t){return jt(t,function(s){return Dt(e[s])})}function ir(e,t){t=Vt(t,e);for(var s=0,c=t.length;e!=null&&s<c;)e=e[bt(t[s++])];return s&&s==c?e:r}function $a(e,t,s){var c=t(e);return k(e)?c:Mt(c,s(e))}function Fe(e){return e==null?e===r?Gh:Bh:Xt&&Xt in oe(e)?tf(e):gf(e)}function tn(e,t){return e>t}function _d(e,t){return e!=null&&ie.call(e,t)}function bd(e,t){return e!=null&&t in oe(e)}function Ed(e,t,s){return e>=De(t,s)&&e<Pe(t,s)}function rn(e,t,s){for(var c=s?Ms:mi,u=e[0].length,p=e.length,f=p,g=w(p),m=1/0,I=[];f--;){var P=e[f];f&&t&&(P=pe(P,Be(t))),m=De(P.length,m),g[f]=!s&&(t||u>=120&&P.length>=120)?new tr(f&&P):r}P=e[0];var S=-1,A=g[0];e:for(;++S<u&&I.length<m;){var $=P[S],j=t?t($):$;if($=s||$!==0?$:0,!(A?kr(A,j):c(I,j,s))){for(f=p;--f;){var K=g[f];if(!(K?kr(K,j):c(e[f],j,s)))continue e}A&&A.push(j),I.push($)}}return I}function Id(e,t,s,c){return wt(e,function(u,p,f){t(c,s(u),p,f)}),c}function Jr(e,t,s){t=Vt(t,e),e=bc(e,t);var c=e==null?e:e[bt(st(t))];return c==null?r:He(c,e,s)}function Fa(e){return ye(e)&&Fe(e)==lr}function Pd(e){return ye(e)&&Fe(e)==Lr}function Sd(e){return ye(e)&&Fe(e)==Fr}function Yr(e,t,s,c,u){return e===t?!0:e==null||t==null||!ye(e)&&!ye(t)?e!==e&&t!==t:Cd(e,t,s,c,Yr,u)}function Cd(e,t,s,c,u,p){var f=k(e),g=k(t),m=f?li:$e(e),I=g?li:$e(t);m=m==lr?Ct:m,I=I==lr?Ct:I;var P=m==Ct,S=I==Ct,A=m==I;if(A&&Ht(e)){if(!Ht(t))return!1;f=!0,P=!1}if(A&&!P)return p||(p=new dt),f||Sr(e)?fc(e,t,s,c,u,p):Xd(e,t,m,s,c,u,p);if(!(s&T)){var $=P&&ie.call(e,"__wrapped__"),j=S&&ie.call(t,"__wrapped__");if($||j){var K=$?e.value():e,M=j?t.value():t;return p||(p=new dt),u(K,M,s,c,p)}}return A?(p||(p=new dt),ef(e,t,s,c,u,p)):!1}function Od(e){return ye(e)&&$e(e)==ht}function sn(e,t,s,c){var u=s.length,p=u,f=!c;if(e==null)return!p;for(e=oe(e);u--;){var g=s[u];if(f&&g[2]?g[1]!==e[g[0]]:!(g[0]in e))return!1}for(;++u<p;){g=s[u];var m=g[0],I=e[m],P=g[1];if(f&&g[2]){if(I===r&&!(m in e))return!1}else{var S=new dt;if(c)var A=c(I,P,m,e,t,S);if(!(A===r?Yr(P,I,T|te,c,S):A))return!1}}return!0}function Ua(e){if(!ge(e)||hf(e))return!1;var t=Dt(e)?Op:vl;return t.test(nr(e))}function Ad(e){return ye(e)&&Fe(e)==jr}function Rd(e){return ye(e)&&$e(e)==lt}function Nd(e){return ye(e)&&es(e.length)&&!!he[Fe(e)]}function ja(e){return typeof e=="function"?e:e==null?Ve:typeof e=="object"?k(e)?La(e[0],e[1]):qa(e):nu(e)}function nn(e){if(!Xr(e))return Dp(e);var t=[];for(var s in oe(e))ie.call(e,s)&&s!="constructor"&&t.push(s);return t}function xd(e){if(!ge(e))return ff(e);var t=Xr(e),s=[];for(var c in e)c=="constructor"&&(t||!ie.call(e,c))||s.push(c);return s}function on(e,t){return e<t}function Ma(e,t){var s=-1,c=ke(e)?w(e.length):[];return kt(e,function(u,p,f){c[++s]=t(u,p,f)}),c}function qa(e){var t=bn(e);return t.length==1&&t[0][2]?wc(t[0][0],t[0][1]):function(s){return s===e||sn(s,e,t)}}function La(e,t){return In(e)&&mc(t)?wc(bt(e),t):function(s){var c=Dn(s,e);return c===r&&c===t?$n(s,e):Yr(t,c,T|te)}}function Mi(e,t,s,c,u){e!==t&&Xs(t,function(p,f){if(u||(u=new dt),ge(p))Td(e,t,f,s,Mi,c,u);else{var g=c?c(Sn(e,f),p,f+"",e,t,u):r;g===r&&(g=p),Zs(e,f,g)}},ze)}function Td(e,t,s,c,u,p,f){var g=Sn(e,s),m=Sn(t,s),I=f.get(m);if(I){Zs(e,s,I);return}var P=p?p(g,m,s+"",e,t,f):r,S=P===r;if(S){var A=k(m),$=!A&&Ht(m),j=!A&&!$&&Sr(m);P=m,A||$||j?k(g)?P=g:me(g)?P=Le(g):$?(S=!1,P=Qa(m,!0)):j?(S=!1,P=Xa(m,!0)):P=[]:ti(m)||or(m)?(P=g,or(g)?P=Jc(g):(!ge(g)||Dt(g))&&(P=vc(m))):S=!1}S&&(f.set(m,P),u(P,m,c,p,f),f.delete(m)),Zs(e,s,P)}function ka(e,t){var s=e.length;if(s)return t+=t<0?s:0,Tt(t,s)?e[t]:r}function za(e,t,s){t.length?t=pe(t,function(p){return k(p)?function(f){return ir(f,p.length===1?p[0]:p)}:p}):t=[Ve];var c=-1;t=pe(t,Be(U()));var u=Ma(e,function(p,f,g){var m=pe(t,function(I){return I(p)});return{criteria:m,index:++c,value:p}});return np(u,function(p,f){return Hd(p,f,s)})}function Dd(e,t){return Va(e,t,function(s,c){return $n(e,c)})}function Va(e,t,s){for(var c=-1,u=t.length,p={};++c<u;){var f=t[c],g=ir(e,f);s(g,f)&&Zr(p,Vt(f,e),g)}return p}function $d(e){return function(t){return ir(t,e)}}function an(e,t,s,c){var u=c?sp:fr,p=-1,f=t.length,g=e;for(e===t&&(t=Le(t)),s&&(g=pe(e,Be(s)));++p<f;)for(var m=0,I=t[p],P=s?s(I):I;(m=u(g,P,m,c))>-1;)g!==e&&Ai.call(g,m,1),Ai.call(e,m,1);return e}function Ka(e,t){for(var s=e?t.length:0,c=s-1;s--;){var u=t[s];if(s==c||u!==p){var p=u;Tt(u)?Ai.call(e,u,1):ln(e,u)}}return e}function cn(e,t){return e+xi(Pa()*(t-e+1))}function Fd(e,t,s,c){for(var u=-1,p=Pe(Ni((t-e)/(s||1)),0),f=w(p);p--;)f[c?p:++u]=e,e+=s;return f}function un(e,t){var s="";if(!e||t<1||t>ce)return s;do t%2&&(s+=e),t=xi(t/2),t&&(e+=e);while(t);return s}function H(e,t){return Cn(_c(e,t,Ve),e+"")}function Ud(e){return Oa(Cr(e))}function jd(e,t){var s=Cr(e);return Gi(s,rr(t,0,s.length))}function Zr(e,t,s,c){if(!ge(e))return e;t=Vt(t,e);for(var u=-1,p=t.length,f=p-1,g=e;g!=null&&++u<p;){var m=bt(t[u]),I=s;if(m==="__proto__"||m==="constructor"||m==="prototype")return e;if(u!=f){var P=g[m];I=c?c(P,m,g):r,I===r&&(I=ge(P)?P:Tt(t[u+1])?[]:{})}Wr(g,m,I),g=g[m]}return e}var Ha=Ti?function(e,t){return Ti.set(e,t),e}:Ve,Md=Ri?function(e,t){return Ri(e,"toString",{configurable:!0,enumerable:!1,value:Un(t),writable:!0})}:Ve;function qd(e){return Gi(Cr(e))}function it(e,t,s){var c=-1,u=e.length;t<0&&(t=-t>u?0:u+t),s=s>u?u:s,s<0&&(s+=u),u=t>s?0:s-t>>>0,t>>>=0;for(var p=w(u);++c<u;)p[c]=e[c+t];return p}function Ld(e,t){var s;return kt(e,function(c,u,p){return s=t(c,u,p),!s}),!!s}function qi(e,t,s){var c=0,u=e==null?c:e.length;if(typeof t=="number"&&t===t&&u<=zh){for(;c<u;){var p=c+u>>>1,f=e[p];f!==null&&!Ge(f)&&(s?f<=t:f<t)?c=p+1:u=p}return u}return hn(e,t,Ve,s)}function hn(e,t,s,c){var u=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var f=t!==t,g=t===null,m=Ge(t),I=t===r;u<p;){var P=xi((u+p)/2),S=s(e[P]),A=S!==r,$=S===null,j=S===S,K=Ge(S);if(f)var M=c||j;else I?M=j&&(c||A):g?M=j&&A&&(c||!$):m?M=j&&A&&!$&&(c||!K):$||K?M=!1:M=c?S<=t:S<t;M?u=P+1:p=P}return De(p,Dr)}function Ba(e,t){for(var s=-1,c=e.length,u=0,p=[];++s<c;){var f=e[s],g=t?t(f):f;if(!s||!ft(g,m)){var m=g;p[u++]=f===0?0:f}}return p}function Wa(e){return typeof e=="number"?e:Ge(e)?St:+e}function We(e){if(typeof e=="string")return e;if(k(e))return pe(e,We)+"";if(Ge(e))return Sa?Sa.call(e):"";var t=e+"";return t=="0"&&1/e==-le?"-0":t}function zt(e,t,s){var c=-1,u=mi,p=e.length,f=!0,g=[],m=g;if(s)f=!1,u=Ms;else if(p>=o){var I=t?null:Zd(e);if(I)return _i(I);f=!1,u=kr,m=new tr}else m=t?[]:g;e:for(;++c<p;){var P=e[c],S=t?t(P):P;if(P=s||P!==0?P:0,f&&S===S){for(var A=m.length;A--;)if(m[A]===S)continue e;t&&m.push(S),g.push(P)}else u(m,S,s)||(m!==g&&m.push(S),g.push(P))}return g}function ln(e,t){return t=Vt(t,e),e=bc(e,t),e==null||delete e[bt(st(t))]}function Ga(e,t,s,c){return Zr(e,t,s(ir(e,t)),c)}function Li(e,t,s,c){for(var u=e.length,p=c?u:-1;(c?p--:++p<u)&&t(e[p],p,e););return s?it(e,c?0:p,c?p+1:u):it(e,c?p+1:0,c?u:p)}function Ja(e,t){var s=e;return s instanceof W&&(s=s.value()),qs(t,function(c,u){return u.func.apply(u.thisArg,Mt([c],u.args))},s)}function pn(e,t,s){var c=e.length;if(c<2)return c?zt(e[0]):[];for(var u=-1,p=w(c);++u<c;)for(var f=e[u],g=-1;++g<c;)g!=u&&(p[u]=Gr(p[u]||f,e[g],t,s));return zt(Ne(p,1),t,s)}function Ya(e,t,s){for(var c=-1,u=e.length,p=t.length,f={};++c<u;){var g=c<p?t[c]:r;s(f,e[c],g)}return f}function dn(e){return me(e)?e:[]}function fn(e){return typeof e=="function"?e:Ve}function Vt(e,t){return k(e)?e:In(e,t)?[e]:Sc(ee(e))}var kd=H;function Kt(e,t,s){var c=e.length;return s=s===r?c:s,!t&&s>=c?e:it(e,t,s)}var Za=Ap||function(e){return Re.clearTimeout(e)};function Qa(e,t){if(t)return e.slice();var s=e.length,c=wa?wa(s):new e.constructor(s);return e.copy(c),c}function gn(e){var t=new e.constructor(e.byteLength);return new Ci(t).set(new Ci(e)),t}function zd(e,t){var s=t?gn(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Vd(e){var t=new e.constructor(e.source,Fo.exec(e));return t.lastIndex=e.lastIndex,t}function Kd(e){return Br?oe(Br.call(e)):{}}function Xa(e,t){var s=t?gn(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function ec(e,t){if(e!==t){var s=e!==r,c=e===null,u=e===e,p=Ge(e),f=t!==r,g=t===null,m=t===t,I=Ge(t);if(!g&&!I&&!p&&e>t||p&&f&&m&&!g&&!I||c&&f&&m||!s&&m||!u)return 1;if(!c&&!p&&!I&&e<t||I&&s&&u&&!c&&!p||g&&s&&u||!f&&u||!m)return-1}return 0}function Hd(e,t,s){for(var c=-1,u=e.criteria,p=t.criteria,f=u.length,g=s.length;++c<f;){var m=ec(u[c],p[c]);if(m){if(c>=g)return m;var I=s[c];return m*(I=="desc"?-1:1)}}return e.index-t.index}function tc(e,t,s,c){for(var u=-1,p=e.length,f=s.length,g=-1,m=t.length,I=Pe(p-f,0),P=w(m+I),S=!c;++g<m;)P[g]=t[g];for(;++u<f;)(S||u<p)&&(P[s[u]]=e[u]);for(;I--;)P[g++]=e[u++];return P}function rc(e,t,s,c){for(var u=-1,p=e.length,f=-1,g=s.length,m=-1,I=t.length,P=Pe(p-g,0),S=w(P+I),A=!c;++u<P;)S[u]=e[u];for(var $=u;++m<I;)S[$+m]=t[m];for(;++f<g;)(A||u<p)&&(S[$+s[f]]=e[u++]);return S}function Le(e,t){var s=-1,c=e.length;for(t||(t=w(c));++s<c;)t[s]=e[s];return t}function _t(e,t,s,c){var u=!s;s||(s={});for(var p=-1,f=t.length;++p<f;){var g=t[p],m=c?c(s[g],e[g],g,s,e):r;m===r&&(m=e[g]),u?Rt(s,g,m):Wr(s,g,m)}return s}function Bd(e,t){return _t(e,En(e),t)}function Wd(e,t){return _t(e,gc(e),t)}function ki(e,t){return function(s,c){var u=k(s)?Ql:gd,p=t?t():{};return u(s,e,U(c,2),p)}}function Er(e){return H(function(t,s){var c=-1,u=s.length,p=u>1?s[u-1]:r,f=u>2?s[2]:r;for(p=e.length>3&&typeof p=="function"?(u--,p):r,f&&Ue(s[0],s[1],f)&&(p=u<3?r:p,u=1),t=oe(t);++c<u;){var g=s[c];g&&e(t,g,c,p)}return t})}function ic(e,t){return function(s,c){if(s==null)return s;if(!ke(s))return e(s,c);for(var u=s.length,p=t?u:-1,f=oe(s);(t?p--:++p<u)&&c(f[p],p,f)!==!1;);return s}}function sc(e){return function(t,s,c){for(var u=-1,p=oe(t),f=c(t),g=f.length;g--;){var m=f[e?g:++u];if(s(p[m],m,p)===!1)break}return t}}function Gd(e,t,s){var c=t&se,u=Qr(e);function p(){var f=this&&this!==Re&&this instanceof p?u:e;return f.apply(c?s:this,arguments)}return p}function nc(e){return function(t){t=ee(t);var s=gr(t)?pt(t):r,c=s?s[0]:t.charAt(0),u=s?Kt(s,1).join(""):t.slice(1);return c[e]()+u}}function Ir(e){return function(t){return qs(iu(ru(t).replace(Ml,"")),e,"")}}function Qr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=br(e.prototype),c=e.apply(s,t);return ge(c)?c:s}}function Jd(e,t,s){var c=Qr(e);function u(){for(var p=arguments.length,f=w(p),g=p,m=Pr(u);g--;)f[g]=arguments[g];var I=p<3&&f[0]!==m&&f[p-1]!==m?[]:qt(f,m);if(p-=I.length,p<s)return hc(e,t,zi,u.placeholder,r,f,I,r,r,s-p);var P=this&&this!==Re&&this instanceof u?c:e;return He(P,this,f)}return u}function oc(e){return function(t,s,c){var u=oe(t);if(!ke(t)){var p=U(s,3);t=Se(t),s=function(g){return p(u[g],g,u)}}var f=e(t,s,c);return f>-1?u[p?t[f]:f]:r}}function ac(e){return xt(function(t){var s=t.length,c=s,u=tt.prototype.thru;for(e&&t.reverse();c--;){var p=t[c];if(typeof p!="function")throw new et(d);if(u&&!f&&Bi(p)=="wrapper")var f=new tt([],!0)}for(c=f?c:s;++c<s;){p=t[c];var g=Bi(p),m=g=="wrapper"?_n(p):r;m&&Pn(m[0])&&m[1]==(de|X|ne|fe)&&!m[4].length&&m[9]==1?f=f[Bi(m[0])].apply(f,m[3]):f=p.length==1&&Pn(p)?f[g]():f.thru(p)}return function(){var I=arguments,P=I[0];if(f&&I.length==1&&k(P))return f.plant(P).value();for(var S=0,A=s?t[S].apply(this,I):P;++S<s;)A=t[S].call(this,A);return A}})}function zi(e,t,s,c,u,p,f,g,m,I){var P=t&de,S=t&se,A=t&ae,$=t&(X|J),j=t&mt,K=A?r:Qr(e);function M(){for(var B=arguments.length,G=w(B),Je=B;Je--;)G[Je]=arguments[Je];if($)var je=Pr(M),Ye=ap(G,je);if(c&&(G=tc(G,c,u,$)),p&&(G=rc(G,p,f,$)),B-=Ye,$&&B<I){var we=qt(G,je);return hc(e,t,zi,M.placeholder,s,G,we,g,m,I-B)}var gt=S?s:this,Ft=A?gt[e]:e;return B=G.length,g?G=yf(G,g):j&&B>1&&G.reverse(),P&&m<B&&(G.length=m),this&&this!==Re&&this instanceof M&&(Ft=K||Qr(Ft)),Ft.apply(gt,G)}return M}function cc(e,t){return function(s,c){return Id(s,e,t(c),{})}}function Vi(e,t){return function(s,c){var u;if(s===r&&c===r)return t;if(s!==r&&(u=s),c!==r){if(u===r)return c;typeof s=="string"||typeof c=="string"?(s=We(s),c=We(c)):(s=Wa(s),c=Wa(c)),u=e(s,c)}return u}}function yn(e){return xt(function(t){return t=pe(t,Be(U())),H(function(s){var c=this;return e(t,function(u){return He(u,c,s)})})})}function Ki(e,t){t=t===r?" ":We(t);var s=t.length;if(s<2)return s?un(t,e):t;var c=un(t,Ni(e/yr(t)));return gr(t)?Kt(pt(c),0,e).join(""):c.slice(0,e)}function Yd(e,t,s,c){var u=t&se,p=Qr(e);function f(){for(var g=-1,m=arguments.length,I=-1,P=c.length,S=w(P+m),A=this&&this!==Re&&this instanceof f?p:e;++I<P;)S[I]=c[I];for(;m--;)S[I++]=arguments[++g];return He(A,u?s:this,S)}return f}function uc(e){return function(t,s,c){return c&&typeof c!="number"&&Ue(t,s,c)&&(s=c=r),t=$t(t),s===r?(s=t,t=0):s=$t(s),c=c===r?t<s?1:-1:$t(c),Fd(t,s,c,e)}}function Hi(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=nt(t),s=nt(s)),e(t,s)}}function hc(e,t,s,c,u,p,f,g,m,I){var P=t&X,S=P?f:r,A=P?r:f,$=P?p:r,j=P?r:p;t|=P?ne:Ae,t&=~(P?Ae:ne),t&Oe||(t&=~(se|ae));var K=[e,t,u,$,S,j,A,g,m,I],M=s.apply(r,K);return Pn(e)&&Ec(M,K),M.placeholder=c,Ic(M,e,t)}function vn(e){var t=Ie[e];return function(s,c){if(s=nt(s),c=c==null?0:De(z(c),292),c&&Ia(s)){var u=(ee(s)+"e").split("e"),p=t(u[0]+"e"+(+u[1]+c));return u=(ee(p)+"e").split("e"),+(u[0]+"e"+(+u[1]-c))}return t(s)}}var Zd=wr&&1/_i(new wr([,-0]))[1]==le?function(e){return new wr(e)}:qn;function lc(e){return function(t){var s=$e(t);return s==ht?Bs(t):s==lt?fp(t):op(t,e(t))}}function Nt(e,t,s,c,u,p,f,g){var m=t&ae;if(!m&&typeof e!="function")throw new et(d);var I=c?c.length:0;if(I||(t&=~(ne|Ae),c=u=r),f=f===r?f:Pe(z(f),0),g=g===r?g:z(g),I-=u?u.length:0,t&Ae){var P=c,S=u;c=u=r}var A=m?r:_n(e),$=[e,t,s,c,u,P,S,p,f,g];if(A&&df($,A),e=$[0],t=$[1],s=$[2],c=$[3],u=$[4],g=$[9]=$[9]===r?m?0:e.length:Pe($[9]-I,0),!g&&t&(X|J)&&(t&=~(X|J)),!t||t==se)var j=Gd(e,t,s);else t==X||t==J?j=Jd(e,t,g):(t==ne||t==(se|ne))&&!u.length?j=Yd(e,t,s,c):j=zi.apply(r,$);var K=A?Ha:Ec;return Ic(K(j,$),e,t)}function pc(e,t,s,c){return e===r||ft(e,mr[s])&&!ie.call(c,s)?t:e}function dc(e,t,s,c,u,p){return ge(e)&&ge(t)&&(p.set(t,e),Mi(e,t,r,dc,p),p.delete(t)),e}function Qd(e){return ti(e)?r:e}function fc(e,t,s,c,u,p){var f=s&T,g=e.length,m=t.length;if(g!=m&&!(f&&m>g))return!1;var I=p.get(e),P=p.get(t);if(I&&P)return I==t&&P==e;var S=-1,A=!0,$=s&te?new tr:r;for(p.set(e,t),p.set(t,e);++S<g;){var j=e[S],K=t[S];if(c)var M=f?c(K,j,S,t,e,p):c(j,K,S,e,t,p);if(M!==r){if(M)continue;A=!1;break}if($){if(!Ls(t,function(B,G){if(!kr($,G)&&(j===B||u(j,B,s,c,p)))return $.push(G)})){A=!1;break}}else if(!(j===K||u(j,K,s,c,p))){A=!1;break}}return p.delete(e),p.delete(t),A}function Xd(e,t,s,c,u,p,f){switch(s){case pr:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Lr:return!(e.byteLength!=t.byteLength||!p(new Ci(e),new Ci(t)));case $r:case Fr:case Ur:return ft(+e,+t);case pi:return e.name==t.name&&e.message==t.message;case jr:case Mr:return e==t+"";case ht:var g=Bs;case lt:var m=c&T;if(g||(g=_i),e.size!=t.size&&!m)return!1;var I=f.get(e);if(I)return I==t;c|=te,f.set(e,t);var P=fc(g(e),g(t),c,u,p,f);return f.delete(e),P;case fi:if(Br)return Br.call(e)==Br.call(t)}return!1}function ef(e,t,s,c,u,p){var f=s&T,g=mn(e),m=g.length,I=mn(t),P=I.length;if(m!=P&&!f)return!1;for(var S=m;S--;){var A=g[S];if(!(f?A in t:ie.call(t,A)))return!1}var $=p.get(e),j=p.get(t);if($&&j)return $==t&&j==e;var K=!0;p.set(e,t),p.set(t,e);for(var M=f;++S<m;){A=g[S];var B=e[A],G=t[A];if(c)var Je=f?c(G,B,A,t,e,p):c(B,G,A,e,t,p);if(!(Je===r?B===G||u(B,G,s,c,p):Je)){K=!1;break}M||(M=A=="constructor")}if(K&&!M){var je=e.constructor,Ye=t.constructor;je!=Ye&&"constructor"in e&&"constructor"in t&&!(typeof je=="function"&&je instanceof je&&typeof Ye=="function"&&Ye instanceof Ye)&&(K=!1)}return p.delete(e),p.delete(t),K}function xt(e){return Cn(_c(e,r,Rc),e+"")}function mn(e){return $a(e,Se,En)}function wn(e){return $a(e,ze,gc)}var _n=Ti?function(e){return Ti.get(e)}:qn;function Bi(e){for(var t=e.name+"",s=_r[t],c=ie.call(_r,t)?s.length:0;c--;){var u=s[c],p=u.func;if(p==null||p==e)return u.name}return t}function Pr(e){var t=ie.call(l,"placeholder")?l:e;return t.placeholder}function U(){var e=l.iteratee||jn;return e=e===jn?ja:e,arguments.length?e(arguments[0],arguments[1]):e}function Wi(e,t){var s=e.__data__;return uf(t)?s[typeof t=="string"?"string":"hash"]:s.map}function bn(e){for(var t=Se(e),s=t.length;s--;){var c=t[s],u=e[c];t[s]=[c,u,mc(u)]}return t}function sr(e,t){var s=lp(e,t);return Ua(s)?s:r}function tf(e){var t=ie.call(e,Xt),s=e[Xt];try{e[Xt]=r;var c=!0}catch{}var u=Pi.call(e);return c&&(t?e[Xt]=s:delete e[Xt]),u}var En=Gs?function(e){return e==null?[]:(e=oe(e),jt(Gs(e),function(t){return ba.call(e,t)}))}:Ln,gc=Gs?function(e){for(var t=[];e;)Mt(t,En(e)),e=Oi(e);return t}:Ln,$e=Fe;(Js&&$e(new Js(new ArrayBuffer(1)))!=pr||Vr&&$e(new Vr)!=ht||Ys&&$e(Ys.resolve())!=xo||wr&&$e(new wr)!=lt||Kr&&$e(new Kr)!=qr)&&($e=function(e){var t=Fe(e),s=t==Ct?e.constructor:r,c=s?nr(s):"";if(c)switch(c){case jp:return pr;case Mp:return ht;case qp:return xo;case Lp:return lt;case kp:return qr}return t});function rf(e,t,s){for(var c=-1,u=s.length;++c<u;){var p=s[c],f=p.size;switch(p.type){case"drop":e+=f;break;case"dropRight":t-=f;break;case"take":t=De(t,e+f);break;case"takeRight":e=Pe(e,t-f);break}}return{start:e,end:t}}function sf(e){var t=e.match(ul);return t?t[1].split(hl):[]}function yc(e,t,s){t=Vt(t,e);for(var c=-1,u=t.length,p=!1;++c<u;){var f=bt(t[c]);if(!(p=e!=null&&s(e,f)))break;e=e[f]}return p||++c!=u?p:(u=e==null?0:e.length,!!u&&es(u)&&Tt(f,u)&&(k(e)||or(e)))}function nf(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&ie.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function vc(e){return typeof e.constructor=="function"&&!Xr(e)?br(Oi(e)):{}}function of(e,t,s){var c=e.constructor;switch(t){case Lr:return gn(e);case $r:case Fr:return new c(+e);case pr:return zd(e,s);case _s:case bs:case Es:case Is:case Ps:case Ss:case Cs:case Os:case As:return Xa(e,s);case ht:return new c;case Ur:case Mr:return new c(e);case jr:return Vd(e);case lt:return new c;case fi:return Kd(e)}}function af(e,t){var s=t.length;if(!s)return e;var c=s-1;return t[c]=(s>1?"& ":"")+t[c],t=t.join(s>2?", ":" "),e.replace(cl,`{
/* [wrapped with `+t+`] */
`)}function cf(e){return k(e)||or(e)||!!(Ea&&e&&e[Ea])}function Tt(e,t){var s=typeof e;return t=t??ce,!!t&&(s=="number"||s!="symbol"&&wl.test(e))&&e>-1&&e%1==0&&e<t}function Ue(e,t,s){if(!ge(s))return!1;var c=typeof t;return(c=="number"?ke(s)&&Tt(t,s.length):c=="string"&&t in s)?ft(s[t],e):!1}function In(e,t){if(k(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||Ge(e)?!0:sl.test(e)||!il.test(e)||t!=null&&e in oe(t)}function uf(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Pn(e){var t=Bi(e),s=l[t];if(typeof s!="function"||!(t in W.prototype))return!1;if(e===s)return!0;var c=_n(s);return!!c&&e===c[0]}function hf(e){return!!ma&&ma in e}var lf=Ei?Dt:kn;function Xr(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||mr;return e===s}function mc(e){return e===e&&!ge(e)}function wc(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==r||e in oe(s))}}function pf(e){var t=Qi(e,function(c){return s.size===C&&s.clear(),c}),s=t.cache;return t}function df(e,t){var s=e[1],c=t[1],u=s|c,p=u<(se|ae|de),f=c==de&&s==X||c==de&&s==fe&&e[7].length<=t[8]||c==(de|fe)&&t[7].length<=t[8]&&s==X;if(!(p||f))return e;c&se&&(e[2]=t[2],u|=s&se?0:Oe);var g=t[3];if(g){var m=e[3];e[3]=m?tc(m,g,t[4]):g,e[4]=m?qt(e[3],D):t[4]}return g=t[5],g&&(m=e[5],e[5]=m?rc(m,g,t[6]):g,e[6]=m?qt(e[5],D):t[6]),g=t[7],g&&(e[7]=g),c&de&&(e[8]=e[8]==null?t[8]:De(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=u,e}function ff(e){var t=[];if(e!=null)for(var s in oe(e))t.push(s);return t}function gf(e){return Pi.call(e)}function _c(e,t,s){return t=Pe(t===r?e.length-1:t,0),function(){for(var c=arguments,u=-1,p=Pe(c.length-t,0),f=w(p);++u<p;)f[u]=c[t+u];u=-1;for(var g=w(t+1);++u<t;)g[u]=c[u];return g[t]=s(f),He(e,this,g)}}function bc(e,t){return t.length<2?e:ir(e,it(t,0,-1))}function yf(e,t){for(var s=e.length,c=De(t.length,s),u=Le(e);c--;){var p=t[c];e[c]=Tt(p,s)?u[p]:r}return e}function Sn(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ec=Pc(Ha),ei=Np||function(e,t){return Re.setTimeout(e,t)},Cn=Pc(Md);function Ic(e,t,s){var c=t+"";return Cn(e,af(c,vf(sf(c),s)))}function Pc(e){var t=0,s=0;return function(){var c=$p(),u=Tr-(c-s);if(s=c,u>0){if(++t>=ws)return arguments[0]}else t=0;return e.apply(r,arguments)}}function Gi(e,t){var s=-1,c=e.length,u=c-1;for(t=t===r?c:t;++s<t;){var p=cn(s,u),f=e[p];e[p]=e[s],e[s]=f}return e.length=t,e}var Sc=pf(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(nl,function(s,c,u,p){t.push(u?p.replace(dl,"$1"):c||s)}),t});function bt(e){if(typeof e=="string"||Ge(e))return e;var t=e+"";return t=="0"&&1/e==-le?"-0":t}function nr(e){if(e!=null){try{return Ii.call(e)}catch{}try{return e+""}catch{}}return""}function vf(e,t){return Xe(Vh,function(s){var c="_."+s[0];t&s[1]&&!mi(e,c)&&e.push(c)}),e.sort()}function Cc(e){if(e instanceof W)return e.clone();var t=new tt(e.__wrapped__,e.__chain__);return t.__actions__=Le(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function mf(e,t,s){(s?Ue(e,t,s):t===r)?t=1:t=Pe(z(t),0);var c=e==null?0:e.length;if(!c||t<1)return[];for(var u=0,p=0,f=w(Ni(c/t));u<c;)f[p++]=it(e,u,u+=t);return f}function wf(e){for(var t=-1,s=e==null?0:e.length,c=0,u=[];++t<s;){var p=e[t];p&&(u[c++]=p)}return u}function _f(){var e=arguments.length;if(!e)return[];for(var t=w(e-1),s=arguments[0],c=e;c--;)t[c-1]=arguments[c];return Mt(k(s)?Le(s):[s],Ne(t,1))}var bf=H(function(e,t){return me(e)?Gr(e,Ne(t,1,me,!0)):[]}),Ef=H(function(e,t){var s=st(t);return me(s)&&(s=r),me(e)?Gr(e,Ne(t,1,me,!0),U(s,2)):[]}),If=H(function(e,t){var s=st(t);return me(s)&&(s=r),me(e)?Gr(e,Ne(t,1,me,!0),r,s):[]});function Pf(e,t,s){var c=e==null?0:e.length;return c?(t=s||t===r?1:z(t),it(e,t<0?0:t,c)):[]}function Sf(e,t,s){var c=e==null?0:e.length;return c?(t=s||t===r?1:z(t),t=c-t,it(e,0,t<0?0:t)):[]}function Cf(e,t){return e&&e.length?Li(e,U(t,3),!0,!0):[]}function Of(e,t){return e&&e.length?Li(e,U(t,3),!0):[]}function Af(e,t,s,c){var u=e==null?0:e.length;return u?(s&&typeof s!="number"&&Ue(e,t,s)&&(s=0,c=u),wd(e,t,s,c)):[]}function Oc(e,t,s){var c=e==null?0:e.length;if(!c)return-1;var u=s==null?0:z(s);return u<0&&(u=Pe(c+u,0)),wi(e,U(t,3),u)}function Ac(e,t,s){var c=e==null?0:e.length;if(!c)return-1;var u=c-1;return s!==r&&(u=z(s),u=s<0?Pe(c+u,0):De(u,c-1)),wi(e,U(t,3),u,!0)}function Rc(e){var t=e==null?0:e.length;return t?Ne(e,1):[]}function Rf(e){var t=e==null?0:e.length;return t?Ne(e,le):[]}function Nf(e,t){var s=e==null?0:e.length;return s?(t=t===r?1:z(t),Ne(e,t)):[]}function xf(e){for(var t=-1,s=e==null?0:e.length,c={};++t<s;){var u=e[t];c[u[0]]=u[1]}return c}function Nc(e){return e&&e.length?e[0]:r}function Tf(e,t,s){var c=e==null?0:e.length;if(!c)return-1;var u=s==null?0:z(s);return u<0&&(u=Pe(c+u,0)),fr(e,t,u)}function Df(e){var t=e==null?0:e.length;return t?it(e,0,-1):[]}var $f=H(function(e){var t=pe(e,dn);return t.length&&t[0]===e[0]?rn(t):[]}),Ff=H(function(e){var t=st(e),s=pe(e,dn);return t===st(s)?t=r:s.pop(),s.length&&s[0]===e[0]?rn(s,U(t,2)):[]}),Uf=H(function(e){var t=st(e),s=pe(e,dn);return t=typeof t=="function"?t:r,t&&s.pop(),s.length&&s[0]===e[0]?rn(s,r,t):[]});function jf(e,t){return e==null?"":Tp.call(e,t)}function st(e){var t=e==null?0:e.length;return t?e[t-1]:r}function Mf(e,t,s){var c=e==null?0:e.length;if(!c)return-1;var u=c;return s!==r&&(u=z(s),u=u<0?Pe(c+u,0):De(u,c-1)),t===t?yp(e,t,u):wi(e,ha,u,!0)}function qf(e,t){return e&&e.length?ka(e,z(t)):r}var Lf=H(xc);function xc(e,t){return e&&e.length&&t&&t.length?an(e,t):e}function kf(e,t,s){return e&&e.length&&t&&t.length?an(e,t,U(s,2)):e}function zf(e,t,s){return e&&e.length&&t&&t.length?an(e,t,r,s):e}var Vf=xt(function(e,t){var s=e==null?0:e.length,c=Qs(e,t);return Ka(e,pe(t,function(u){return Tt(u,s)?+u:u}).sort(ec)),c});function Kf(e,t){var s=[];if(!(e&&e.length))return s;var c=-1,u=[],p=e.length;for(t=U(t,3);++c<p;){var f=e[c];t(f,c,e)&&(s.push(f),u.push(c))}return Ka(e,u),s}function On(e){return e==null?e:Up.call(e)}function Hf(e,t,s){var c=e==null?0:e.length;return c?(s&&typeof s!="number"&&Ue(e,t,s)?(t=0,s=c):(t=t==null?0:z(t),s=s===r?c:z(s)),it(e,t,s)):[]}function Bf(e,t){return qi(e,t)}function Wf(e,t,s){return hn(e,t,U(s,2))}function Gf(e,t){var s=e==null?0:e.length;if(s){var c=qi(e,t);if(c<s&&ft(e[c],t))return c}return-1}function Jf(e,t){return qi(e,t,!0)}function Yf(e,t,s){return hn(e,t,U(s,2),!0)}function Zf(e,t){var s=e==null?0:e.length;if(s){var c=qi(e,t,!0)-1;if(ft(e[c],t))return c}return-1}function Qf(e){return e&&e.length?Ba(e):[]}function Xf(e,t){return e&&e.length?Ba(e,U(t,2)):[]}function eg(e){var t=e==null?0:e.length;return t?it(e,1,t):[]}function tg(e,t,s){return e&&e.length?(t=s||t===r?1:z(t),it(e,0,t<0?0:t)):[]}function rg(e,t,s){var c=e==null?0:e.length;return c?(t=s||t===r?1:z(t),t=c-t,it(e,t<0?0:t,c)):[]}function ig(e,t){return e&&e.length?Li(e,U(t,3),!1,!0):[]}function sg(e,t){return e&&e.length?Li(e,U(t,3)):[]}var ng=H(function(e){return zt(Ne(e,1,me,!0))}),og=H(function(e){var t=st(e);return me(t)&&(t=r),zt(Ne(e,1,me,!0),U(t,2))}),ag=H(function(e){var t=st(e);return t=typeof t=="function"?t:r,zt(Ne(e,1,me,!0),r,t)});function cg(e){return e&&e.length?zt(e):[]}function ug(e,t){return e&&e.length?zt(e,U(t,2)):[]}function hg(e,t){return t=typeof t=="function"?t:r,e&&e.length?zt(e,r,t):[]}function An(e){if(!(e&&e.length))return[];var t=0;return e=jt(e,function(s){if(me(s))return t=Pe(s.length,t),!0}),Ks(t,function(s){return pe(e,ks(s))})}function Tc(e,t){if(!(e&&e.length))return[];var s=An(e);return t==null?s:pe(s,function(c){return He(t,r,c)})}var lg=H(function(e,t){return me(e)?Gr(e,t):[]}),pg=H(function(e){return pn(jt(e,me))}),dg=H(function(e){var t=st(e);return me(t)&&(t=r),pn(jt(e,me),U(t,2))}),fg=H(function(e){var t=st(e);return t=typeof t=="function"?t:r,pn(jt(e,me),r,t)}),gg=H(An);function yg(e,t){return Ya(e||[],t||[],Wr)}function vg(e,t){return Ya(e||[],t||[],Zr)}var mg=H(function(e){var t=e.length,s=t>1?e[t-1]:r;return s=typeof s=="function"?(e.pop(),s):r,Tc(e,s)});function Dc(e){var t=l(e);return t.__chain__=!0,t}function wg(e,t){return t(e),e}function Ji(e,t){return t(e)}var _g=xt(function(e){var t=e.length,s=t?e[0]:0,c=this.__wrapped__,u=function(p){return Qs(p,e)};return t>1||this.__actions__.length||!(c instanceof W)||!Tt(s)?this.thru(u):(c=c.slice(s,+s+(t?1:0)),c.__actions__.push({func:Ji,args:[u],thisArg:r}),new tt(c,this.__chain__).thru(function(p){return t&&!p.length&&p.push(r),p}))});function bg(){return Dc(this)}function Eg(){return new tt(this.value(),this.__chain__)}function Ig(){this.__values__===r&&(this.__values__=Wc(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Pg(){return this}function Sg(e){for(var t,s=this;s instanceof $i;){var c=Cc(s);c.__index__=0,c.__values__=r,t?u.__wrapped__=c:t=c;var u=c;s=s.__wrapped__}return u.__wrapped__=e,t}function Cg(){var e=this.__wrapped__;if(e instanceof W){var t=e;return this.__actions__.length&&(t=new W(this)),t=t.reverse(),t.__actions__.push({func:Ji,args:[On],thisArg:r}),new tt(t,this.__chain__)}return this.thru(On)}function Og(){return Ja(this.__wrapped__,this.__actions__)}var Ag=ki(function(e,t,s){ie.call(e,s)?++e[s]:Rt(e,s,1)});function Rg(e,t,s){var c=k(e)?ca:md;return s&&Ue(e,t,s)&&(t=r),c(e,U(t,3))}function Ng(e,t){var s=k(e)?jt:Ta;return s(e,U(t,3))}var xg=oc(Oc),Tg=oc(Ac);function Dg(e,t){return Ne(Yi(e,t),1)}function $g(e,t){return Ne(Yi(e,t),le)}function Fg(e,t,s){return s=s===r?1:z(s),Ne(Yi(e,t),s)}function $c(e,t){var s=k(e)?Xe:kt;return s(e,U(t,3))}function Fc(e,t){var s=k(e)?Xl:xa;return s(e,U(t,3))}var Ug=ki(function(e,t,s){ie.call(e,s)?e[s].push(t):Rt(e,s,[t])});function jg(e,t,s,c){e=ke(e)?e:Cr(e),s=s&&!c?z(s):0;var u=e.length;return s<0&&(s=Pe(u+s,0)),ts(e)?s<=u&&e.indexOf(t,s)>-1:!!u&&fr(e,t,s)>-1}var Mg=H(function(e,t,s){var c=-1,u=typeof t=="function",p=ke(e)?w(e.length):[];return kt(e,function(f){p[++c]=u?He(t,f,s):Jr(f,t,s)}),p}),qg=ki(function(e,t,s){Rt(e,s,t)});function Yi(e,t){var s=k(e)?pe:Ma;return s(e,U(t,3))}function Lg(e,t,s,c){return e==null?[]:(k(t)||(t=t==null?[]:[t]),s=c?r:s,k(s)||(s=s==null?[]:[s]),za(e,t,s))}var kg=ki(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function zg(e,t,s){var c=k(e)?qs:pa,u=arguments.length<3;return c(e,U(t,4),s,u,kt)}function Vg(e,t,s){var c=k(e)?ep:pa,u=arguments.length<3;return c(e,U(t,4),s,u,xa)}function Kg(e,t){var s=k(e)?jt:Ta;return s(e,Xi(U(t,3)))}function Hg(e){var t=k(e)?Oa:Ud;return t(e)}function Bg(e,t,s){(s?Ue(e,t,s):t===r)?t=1:t=z(t);var c=k(e)?dd:jd;return c(e,t)}function Wg(e){var t=k(e)?fd:qd;return t(e)}function Gg(e){if(e==null)return 0;if(ke(e))return ts(e)?yr(e):e.length;var t=$e(e);return t==ht||t==lt?e.size:nn(e).length}function Jg(e,t,s){var c=k(e)?Ls:Ld;return s&&Ue(e,t,s)&&(t=r),c(e,U(t,3))}var Yg=H(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Ue(e,t[0],t[1])?t=[]:s>2&&Ue(t[0],t[1],t[2])&&(t=[t[0]]),za(e,Ne(t,1),[])}),Zi=Rp||function(){return Re.Date.now()};function Zg(e,t){if(typeof t!="function")throw new et(d);return e=z(e),function(){if(--e<1)return t.apply(this,arguments)}}function Uc(e,t,s){return t=s?r:t,t=e&&t==null?e.length:t,Nt(e,de,r,r,r,r,t)}function jc(e,t){var s;if(typeof t!="function")throw new et(d);return e=z(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=r),s}}var Rn=H(function(e,t,s){var c=se;if(s.length){var u=qt(s,Pr(Rn));c|=ne}return Nt(e,c,t,s,u)}),Mc=H(function(e,t,s){var c=se|ae;if(s.length){var u=qt(s,Pr(Mc));c|=ne}return Nt(t,c,e,s,u)});function qc(e,t,s){t=s?r:t;var c=Nt(e,X,r,r,r,r,r,t);return c.placeholder=qc.placeholder,c}function Lc(e,t,s){t=s?r:t;var c=Nt(e,J,r,r,r,r,r,t);return c.placeholder=Lc.placeholder,c}function kc(e,t,s){var c,u,p,f,g,m,I=0,P=!1,S=!1,A=!0;if(typeof e!="function")throw new et(d);t=nt(t)||0,ge(s)&&(P=!!s.leading,S="maxWait"in s,p=S?Pe(nt(s.maxWait)||0,t):p,A="trailing"in s?!!s.trailing:A);function $(we){var gt=c,Ft=u;return c=u=r,I=we,f=e.apply(Ft,gt),f}function j(we){return I=we,g=ei(B,t),P?$(we):f}function K(we){var gt=we-m,Ft=we-I,ou=t-gt;return S?De(ou,p-Ft):ou}function M(we){var gt=we-m,Ft=we-I;return m===r||gt>=t||gt<0||S&&Ft>=p}function B(){var we=Zi();if(M(we))return G(we);g=ei(B,K(we))}function G(we){return g=r,A&&c?$(we):(c=u=r,f)}function Je(){g!==r&&Za(g),I=0,c=m=u=g=r}function je(){return g===r?f:G(Zi())}function Ye(){var we=Zi(),gt=M(we);if(c=arguments,u=this,m=we,gt){if(g===r)return j(m);if(S)return Za(g),g=ei(B,t),$(m)}return g===r&&(g=ei(B,t)),f}return Ye.cancel=Je,Ye.flush=je,Ye}var Qg=H(function(e,t){return Na(e,1,t)}),Xg=H(function(e,t,s){return Na(e,nt(t)||0,s)});function ey(e){return Nt(e,mt)}function Qi(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new et(d);var s=function(){var c=arguments,u=t?t.apply(this,c):c[0],p=s.cache;if(p.has(u))return p.get(u);var f=e.apply(this,c);return s.cache=p.set(u,f)||p,f};return s.cache=new(Qi.Cache||At),s}Qi.Cache=At;function Xi(e){if(typeof e!="function")throw new et(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function ty(e){return jc(2,e)}var ry=kd(function(e,t){t=t.length==1&&k(t[0])?pe(t[0],Be(U())):pe(Ne(t,1),Be(U()));var s=t.length;return H(function(c){for(var u=-1,p=De(c.length,s);++u<p;)c[u]=t[u].call(this,c[u]);return He(e,this,c)})}),Nn=H(function(e,t){var s=qt(t,Pr(Nn));return Nt(e,ne,r,t,s)}),zc=H(function(e,t){var s=qt(t,Pr(zc));return Nt(e,Ae,r,t,s)}),iy=xt(function(e,t){return Nt(e,fe,r,r,r,t)});function sy(e,t){if(typeof e!="function")throw new et(d);return t=t===r?t:z(t),H(e,t)}function ny(e,t){if(typeof e!="function")throw new et(d);return t=t==null?0:Pe(z(t),0),H(function(s){var c=s[t],u=Kt(s,0,t);return c&&Mt(u,c),He(e,this,u)})}function oy(e,t,s){var c=!0,u=!0;if(typeof e!="function")throw new et(d);return ge(s)&&(c="leading"in s?!!s.leading:c,u="trailing"in s?!!s.trailing:u),kc(e,t,{leading:c,maxWait:t,trailing:u})}function ay(e){return Uc(e,1)}function cy(e,t){return Nn(fn(t),e)}function uy(){if(!arguments.length)return[];var e=arguments[0];return k(e)?e:[e]}function hy(e){return rt(e,Z)}function ly(e,t){return t=typeof t=="function"?t:r,rt(e,Z,t)}function py(e){return rt(e,x|Z)}function dy(e,t){return t=typeof t=="function"?t:r,rt(e,x|Z,t)}function fy(e,t){return t==null||Ra(e,t,Se(t))}function ft(e,t){return e===t||e!==e&&t!==t}var gy=Hi(tn),yy=Hi(function(e,t){return e>=t}),or=Fa(function(){return arguments}())?Fa:function(e){return ye(e)&&ie.call(e,"callee")&&!ba.call(e,"callee")},k=w.isArray,vy=ra?Be(ra):Pd;function ke(e){return e!=null&&es(e.length)&&!Dt(e)}function me(e){return ye(e)&&ke(e)}function my(e){return e===!0||e===!1||ye(e)&&Fe(e)==$r}var Ht=xp||kn,wy=ia?Be(ia):Sd;function _y(e){return ye(e)&&e.nodeType===1&&!ti(e)}function by(e){if(e==null)return!0;if(ke(e)&&(k(e)||typeof e=="string"||typeof e.splice=="function"||Ht(e)||Sr(e)||or(e)))return!e.length;var t=$e(e);if(t==ht||t==lt)return!e.size;if(Xr(e))return!nn(e).length;for(var s in e)if(ie.call(e,s))return!1;return!0}function Ey(e,t){return Yr(e,t)}function Iy(e,t,s){s=typeof s=="function"?s:r;var c=s?s(e,t):r;return c===r?Yr(e,t,r,s):!!c}function xn(e){if(!ye(e))return!1;var t=Fe(e);return t==pi||t==Hh||typeof e.message=="string"&&typeof e.name=="string"&&!ti(e)}function Py(e){return typeof e=="number"&&Ia(e)}function Dt(e){if(!ge(e))return!1;var t=Fe(e);return t==di||t==No||t==Kh||t==Wh}function Vc(e){return typeof e=="number"&&e==z(e)}function es(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ce}function ge(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function ye(e){return e!=null&&typeof e=="object"}var Kc=sa?Be(sa):Od;function Sy(e,t){return e===t||sn(e,t,bn(t))}function Cy(e,t,s){return s=typeof s=="function"?s:r,sn(e,t,bn(t),s)}function Oy(e){return Hc(e)&&e!=+e}function Ay(e){if(lf(e))throw new L(h);return Ua(e)}function Ry(e){return e===null}function Ny(e){return e==null}function Hc(e){return typeof e=="number"||ye(e)&&Fe(e)==Ur}function ti(e){if(!ye(e)||Fe(e)!=Ct)return!1;var t=Oi(e);if(t===null)return!0;var s=ie.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&Ii.call(s)==Sp}var Tn=na?Be(na):Ad;function xy(e){return Vc(e)&&e>=-ce&&e<=ce}var Bc=oa?Be(oa):Rd;function ts(e){return typeof e=="string"||!k(e)&&ye(e)&&Fe(e)==Mr}function Ge(e){return typeof e=="symbol"||ye(e)&&Fe(e)==fi}var Sr=aa?Be(aa):Nd;function Ty(e){return e===r}function Dy(e){return ye(e)&&$e(e)==qr}function $y(e){return ye(e)&&Fe(e)==Jh}var Fy=Hi(on),Uy=Hi(function(e,t){return e<=t});function Wc(e){if(!e)return[];if(ke(e))return ts(e)?pt(e):Le(e);if(zr&&e[zr])return dp(e[zr]());var t=$e(e),s=t==ht?Bs:t==lt?_i:Cr;return s(e)}function $t(e){if(!e)return e===0?e:0;if(e=nt(e),e===le||e===-le){var t=e<0?-1:1;return t*re}return e===e?e:0}function z(e){var t=$t(e),s=t%1;return t===t?s?t-s:t:0}function Gc(e){return e?rr(z(e),0,Te):0}function nt(e){if(typeof e=="number")return e;if(Ge(e))return St;if(ge(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ge(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=da(e);var s=yl.test(e);return s||ml.test(e)?Yl(e.slice(2),s?2:8):gl.test(e)?St:+e}function Jc(e){return _t(e,ze(e))}function jy(e){return e?rr(z(e),-ce,ce):e===0?e:0}function ee(e){return e==null?"":We(e)}var My=Er(function(e,t){if(Xr(t)||ke(t)){_t(t,Se(t),e);return}for(var s in t)ie.call(t,s)&&Wr(e,s,t[s])}),Yc=Er(function(e,t){_t(t,ze(t),e)}),rs=Er(function(e,t,s,c){_t(t,ze(t),e,c)}),qy=Er(function(e,t,s,c){_t(t,Se(t),e,c)}),Ly=xt(Qs);function ky(e,t){var s=br(e);return t==null?s:Aa(s,t)}var zy=H(function(e,t){e=oe(e);var s=-1,c=t.length,u=c>2?t[2]:r;for(u&&Ue(t[0],t[1],u)&&(c=1);++s<c;)for(var p=t[s],f=ze(p),g=-1,m=f.length;++g<m;){var I=f[g],P=e[I];(P===r||ft(P,mr[I])&&!ie.call(e,I))&&(e[I]=p[I])}return e}),Vy=H(function(e){return e.push(r,dc),He(Zc,r,e)});function Ky(e,t){return ua(e,U(t,3),wt)}function Hy(e,t){return ua(e,U(t,3),en)}function By(e,t){return e==null?e:Xs(e,U(t,3),ze)}function Wy(e,t){return e==null?e:Da(e,U(t,3),ze)}function Gy(e,t){return e&&wt(e,U(t,3))}function Jy(e,t){return e&&en(e,U(t,3))}function Yy(e){return e==null?[]:ji(e,Se(e))}function Zy(e){return e==null?[]:ji(e,ze(e))}function Dn(e,t,s){var c=e==null?r:ir(e,t);return c===r?s:c}function Qy(e,t){return e!=null&&yc(e,t,_d)}function $n(e,t){return e!=null&&yc(e,t,bd)}var Xy=cc(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Pi.call(t)),e[t]=s},Un(Ve)),ev=cc(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Pi.call(t)),ie.call(e,t)?e[t].push(s):e[t]=[s]},U),tv=H(Jr);function Se(e){return ke(e)?Ca(e):nn(e)}function ze(e){return ke(e)?Ca(e,!0):xd(e)}function rv(e,t){var s={};return t=U(t,3),wt(e,function(c,u,p){Rt(s,t(c,u,p),c)}),s}function iv(e,t){var s={};return t=U(t,3),wt(e,function(c,u,p){Rt(s,u,t(c,u,p))}),s}var sv=Er(function(e,t,s){Mi(e,t,s)}),Zc=Er(function(e,t,s,c){Mi(e,t,s,c)}),nv=xt(function(e,t){var s={};if(e==null)return s;var c=!1;t=pe(t,function(p){return p=Vt(p,e),c||(c=p.length>1),p}),_t(e,wn(e),s),c&&(s=rt(s,x|q|Z,Qd));for(var u=t.length;u--;)ln(s,t[u]);return s});function ov(e,t){return Qc(e,Xi(U(t)))}var av=xt(function(e,t){return e==null?{}:Dd(e,t)});function Qc(e,t){if(e==null)return{};var s=pe(wn(e),function(c){return[c]});return t=U(t),Va(e,s,function(c,u){return t(c,u[0])})}function cv(e,t,s){t=Vt(t,e);var c=-1,u=t.length;for(u||(u=1,e=r);++c<u;){var p=e==null?r:e[bt(t[c])];p===r&&(c=u,p=s),e=Dt(p)?p.call(e):p}return e}function uv(e,t,s){return e==null?e:Zr(e,t,s)}function hv(e,t,s,c){return c=typeof c=="function"?c:r,e==null?e:Zr(e,t,s,c)}var Xc=lc(Se),eu=lc(ze);function lv(e,t,s){var c=k(e),u=c||Ht(e)||Sr(e);if(t=U(t,4),s==null){var p=e&&e.constructor;u?s=c?new p:[]:ge(e)?s=Dt(p)?br(Oi(e)):{}:s={}}return(u?Xe:wt)(e,function(f,g,m){return t(s,f,g,m)}),s}function pv(e,t){return e==null?!0:ln(e,t)}function dv(e,t,s){return e==null?e:Ga(e,t,fn(s))}function fv(e,t,s,c){return c=typeof c=="function"?c:r,e==null?e:Ga(e,t,fn(s),c)}function Cr(e){return e==null?[]:Hs(e,Se(e))}function gv(e){return e==null?[]:Hs(e,ze(e))}function yv(e,t,s){return s===r&&(s=t,t=r),s!==r&&(s=nt(s),s=s===s?s:0),t!==r&&(t=nt(t),t=t===t?t:0),rr(nt(e),t,s)}function vv(e,t,s){return t=$t(t),s===r?(s=t,t=0):s=$t(s),e=nt(e),Ed(e,t,s)}function mv(e,t,s){if(s&&typeof s!="boolean"&&Ue(e,t,s)&&(t=s=r),s===r&&(typeof t=="boolean"?(s=t,t=r):typeof e=="boolean"&&(s=e,e=r)),e===r&&t===r?(e=0,t=1):(e=$t(e),t===r?(t=e,e=0):t=$t(t)),e>t){var c=e;e=t,t=c}if(s||e%1||t%1){var u=Pa();return De(e+u*(t-e+Jl("1e-"+((u+"").length-1))),t)}return cn(e,t)}var wv=Ir(function(e,t,s){return t=t.toLowerCase(),e+(s?tu(t):t)});function tu(e){return Fn(ee(e).toLowerCase())}function ru(e){return e=ee(e),e&&e.replace(_l,cp).replace(ql,"")}function _v(e,t,s){e=ee(e),t=We(t);var c=e.length;s=s===r?c:rr(z(s),0,c);var u=s;return s-=t.length,s>=0&&e.slice(s,u)==t}function bv(e){return e=ee(e),e&&el.test(e)?e.replace(Do,up):e}function Ev(e){return e=ee(e),e&&ol.test(e)?e.replace(Rs,"\\$&"):e}var Iv=Ir(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),Pv=Ir(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),Sv=nc("toLowerCase");function Cv(e,t,s){e=ee(e),t=z(t);var c=t?yr(e):0;if(!t||c>=t)return e;var u=(t-c)/2;return Ki(xi(u),s)+e+Ki(Ni(u),s)}function Ov(e,t,s){e=ee(e),t=z(t);var c=t?yr(e):0;return t&&c<t?e+Ki(t-c,s):e}function Av(e,t,s){e=ee(e),t=z(t);var c=t?yr(e):0;return t&&c<t?Ki(t-c,s)+e:e}function Rv(e,t,s){return s||t==null?t=0:t&&(t=+t),Fp(ee(e).replace(Ns,""),t||0)}function Nv(e,t,s){return(s?Ue(e,t,s):t===r)?t=1:t=z(t),un(ee(e),t)}function xv(){var e=arguments,t=ee(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Tv=Ir(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function Dv(e,t,s){return s&&typeof s!="number"&&Ue(e,t,s)&&(t=s=r),s=s===r?Te:s>>>0,s?(e=ee(e),e&&(typeof t=="string"||t!=null&&!Tn(t))&&(t=We(t),!t&&gr(e))?Kt(pt(e),0,s):e.split(t,s)):[]}var $v=Ir(function(e,t,s){return e+(s?" ":"")+Fn(t)});function Fv(e,t,s){return e=ee(e),s=s==null?0:rr(z(s),0,e.length),t=We(t),e.slice(s,s+t.length)==t}function Uv(e,t,s){var c=l.templateSettings;s&&Ue(e,t,s)&&(t=r),e=ee(e),t=rs({},t,c,pc);var u=rs({},t.imports,c.imports,pc),p=Se(u),f=Hs(u,p),g,m,I=0,P=t.interpolate||gi,S="__p += '",A=Ws((t.escape||gi).source+"|"+P.source+"|"+(P===$o?fl:gi).source+"|"+(t.evaluate||gi).source+"|$","g"),$="//# sourceURL="+(ie.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Kl+"]")+`
`;e.replace(A,function(M,B,G,Je,je,Ye){return G||(G=Je),S+=e.slice(I,Ye).replace(bl,hp),B&&(g=!0,S+=`' +
__e(`+B+`) +
'`),je&&(m=!0,S+=`';
`+je+`;
__p += '`),G&&(S+=`' +
((__t = (`+G+`)) == null ? '' : __t) +
'`),I=Ye+M.length,M}),S+=`';
`;var j=ie.call(t,"variable")&&t.variable;if(!j)S=`with (obj) {
`+S+`
}
`;else if(pl.test(j))throw new L(y);S=(m?S.replace(Yh,""):S).replace(Zh,"$1").replace(Qh,"$1;"),S="function("+(j||"obj")+`) {
`+(j?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(g?", __e = _.escape":"")+(m?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+S+`return __p
}`;var K=su(function(){return Q(p,$+"return "+S).apply(r,f)});if(K.source=S,xn(K))throw K;return K}function jv(e){return ee(e).toLowerCase()}function Mv(e){return ee(e).toUpperCase()}function qv(e,t,s){if(e=ee(e),e&&(s||t===r))return da(e);if(!e||!(t=We(t)))return e;var c=pt(e),u=pt(t),p=fa(c,u),f=ga(c,u)+1;return Kt(c,p,f).join("")}function Lv(e,t,s){if(e=ee(e),e&&(s||t===r))return e.slice(0,va(e)+1);if(!e||!(t=We(t)))return e;var c=pt(e),u=ga(c,pt(t))+1;return Kt(c,0,u).join("")}function kv(e,t,s){if(e=ee(e),e&&(s||t===r))return e.replace(Ns,"");if(!e||!(t=We(t)))return e;var c=pt(e),u=fa(c,pt(t));return Kt(c,u).join("")}function zv(e,t){var s=ms,c=Ze;if(ge(t)){var u="separator"in t?t.separator:u;s="length"in t?z(t.length):s,c="omission"in t?We(t.omission):c}e=ee(e);var p=e.length;if(gr(e)){var f=pt(e);p=f.length}if(s>=p)return e;var g=s-yr(c);if(g<1)return c;var m=f?Kt(f,0,g).join(""):e.slice(0,g);if(u===r)return m+c;if(f&&(g+=m.length-g),Tn(u)){if(e.slice(g).search(u)){var I,P=m;for(u.global||(u=Ws(u.source,ee(Fo.exec(u))+"g")),u.lastIndex=0;I=u.exec(P);)var S=I.index;m=m.slice(0,S===r?g:S)}}else if(e.indexOf(We(u),g)!=g){var A=m.lastIndexOf(u);A>-1&&(m=m.slice(0,A))}return m+c}function Vv(e){return e=ee(e),e&&Xh.test(e)?e.replace(To,vp):e}var Kv=Ir(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Fn=nc("toUpperCase");function iu(e,t,s){return e=ee(e),t=s?r:t,t===r?pp(e)?_p(e):ip(e):e.match(t)||[]}var su=H(function(e,t){try{return He(e,r,t)}catch(s){return xn(s)?s:new L(s)}}),Hv=xt(function(e,t){return Xe(t,function(s){s=bt(s),Rt(e,s,Rn(e[s],e))}),e});function Bv(e){var t=e==null?0:e.length,s=U();return e=t?pe(e,function(c){if(typeof c[1]!="function")throw new et(d);return[s(c[0]),c[1]]}):[],H(function(c){for(var u=-1;++u<t;){var p=e[u];if(He(p[0],this,c))return He(p[1],this,c)}})}function Wv(e){return vd(rt(e,x))}function Un(e){return function(){return e}}function Gv(e,t){return e==null||e!==e?t:e}var Jv=ac(),Yv=ac(!0);function Ve(e){return e}function jn(e){return ja(typeof e=="function"?e:rt(e,x))}function Zv(e){return qa(rt(e,x))}function Qv(e,t){return La(e,rt(t,x))}var Xv=H(function(e,t){return function(s){return Jr(s,e,t)}}),em=H(function(e,t){return function(s){return Jr(e,s,t)}});function Mn(e,t,s){var c=Se(t),u=ji(t,c);s==null&&!(ge(t)&&(u.length||!c.length))&&(s=t,t=e,e=this,u=ji(t,Se(t)));var p=!(ge(s)&&"chain"in s)||!!s.chain,f=Dt(e);return Xe(u,function(g){var m=t[g];e[g]=m,f&&(e.prototype[g]=function(){var I=this.__chain__;if(p||I){var P=e(this.__wrapped__),S=P.__actions__=Le(this.__actions__);return S.push({func:m,args:arguments,thisArg:e}),P.__chain__=I,P}return m.apply(e,Mt([this.value()],arguments))})}),e}function tm(){return Re._===this&&(Re._=Cp),this}function qn(){}function rm(e){return e=z(e),H(function(t){return ka(t,e)})}var im=yn(pe),sm=yn(ca),nm=yn(Ls);function nu(e){return In(e)?ks(bt(e)):$d(e)}function om(e){return function(t){return e==null?r:ir(e,t)}}var am=uc(),cm=uc(!0);function Ln(){return[]}function kn(){return!1}function um(){return{}}function hm(){return""}function lm(){return!0}function pm(e,t){if(e=z(e),e<1||e>ce)return[];var s=Te,c=De(e,Te);t=U(t),e-=Te;for(var u=Ks(c,t);++s<e;)t(s);return u}function dm(e){return k(e)?pe(e,bt):Ge(e)?[e]:Le(Sc(ee(e)))}function fm(e){var t=++Pp;return ee(e)+t}var gm=Vi(function(e,t){return e+t},0),ym=vn("ceil"),vm=Vi(function(e,t){return e/t},1),mm=vn("floor");function wm(e){return e&&e.length?Ui(e,Ve,tn):r}function _m(e,t){return e&&e.length?Ui(e,U(t,2),tn):r}function bm(e){return la(e,Ve)}function Em(e,t){return la(e,U(t,2))}function Im(e){return e&&e.length?Ui(e,Ve,on):r}function Pm(e,t){return e&&e.length?Ui(e,U(t,2),on):r}var Sm=Vi(function(e,t){return e*t},1),Cm=vn("round"),Om=Vi(function(e,t){return e-t},0);function Am(e){return e&&e.length?Vs(e,Ve):0}function Rm(e,t){return e&&e.length?Vs(e,U(t,2)):0}return l.after=Zg,l.ary=Uc,l.assign=My,l.assignIn=Yc,l.assignInWith=rs,l.assignWith=qy,l.at=Ly,l.before=jc,l.bind=Rn,l.bindAll=Hv,l.bindKey=Mc,l.castArray=uy,l.chain=Dc,l.chunk=mf,l.compact=wf,l.concat=_f,l.cond=Bv,l.conforms=Wv,l.constant=Un,l.countBy=Ag,l.create=ky,l.curry=qc,l.curryRight=Lc,l.debounce=kc,l.defaults=zy,l.defaultsDeep=Vy,l.defer=Qg,l.delay=Xg,l.difference=bf,l.differenceBy=Ef,l.differenceWith=If,l.drop=Pf,l.dropRight=Sf,l.dropRightWhile=Cf,l.dropWhile=Of,l.fill=Af,l.filter=Ng,l.flatMap=Dg,l.flatMapDeep=$g,l.flatMapDepth=Fg,l.flatten=Rc,l.flattenDeep=Rf,l.flattenDepth=Nf,l.flip=ey,l.flow=Jv,l.flowRight=Yv,l.fromPairs=xf,l.functions=Yy,l.functionsIn=Zy,l.groupBy=Ug,l.initial=Df,l.intersection=$f,l.intersectionBy=Ff,l.intersectionWith=Uf,l.invert=Xy,l.invertBy=ev,l.invokeMap=Mg,l.iteratee=jn,l.keyBy=qg,l.keys=Se,l.keysIn=ze,l.map=Yi,l.mapKeys=rv,l.mapValues=iv,l.matches=Zv,l.matchesProperty=Qv,l.memoize=Qi,l.merge=sv,l.mergeWith=Zc,l.method=Xv,l.methodOf=em,l.mixin=Mn,l.negate=Xi,l.nthArg=rm,l.omit=nv,l.omitBy=ov,l.once=ty,l.orderBy=Lg,l.over=im,l.overArgs=ry,l.overEvery=sm,l.overSome=nm,l.partial=Nn,l.partialRight=zc,l.partition=kg,l.pick=av,l.pickBy=Qc,l.property=nu,l.propertyOf=om,l.pull=Lf,l.pullAll=xc,l.pullAllBy=kf,l.pullAllWith=zf,l.pullAt=Vf,l.range=am,l.rangeRight=cm,l.rearg=iy,l.reject=Kg,l.remove=Kf,l.rest=sy,l.reverse=On,l.sampleSize=Bg,l.set=uv,l.setWith=hv,l.shuffle=Wg,l.slice=Hf,l.sortBy=Yg,l.sortedUniq=Qf,l.sortedUniqBy=Xf,l.split=Dv,l.spread=ny,l.tail=eg,l.take=tg,l.takeRight=rg,l.takeRightWhile=ig,l.takeWhile=sg,l.tap=wg,l.throttle=oy,l.thru=Ji,l.toArray=Wc,l.toPairs=Xc,l.toPairsIn=eu,l.toPath=dm,l.toPlainObject=Jc,l.transform=lv,l.unary=ay,l.union=ng,l.unionBy=og,l.unionWith=ag,l.uniq=cg,l.uniqBy=ug,l.uniqWith=hg,l.unset=pv,l.unzip=An,l.unzipWith=Tc,l.update=dv,l.updateWith=fv,l.values=Cr,l.valuesIn=gv,l.without=lg,l.words=iu,l.wrap=cy,l.xor=pg,l.xorBy=dg,l.xorWith=fg,l.zip=gg,l.zipObject=yg,l.zipObjectDeep=vg,l.zipWith=mg,l.entries=Xc,l.entriesIn=eu,l.extend=Yc,l.extendWith=rs,Mn(l,l),l.add=gm,l.attempt=su,l.camelCase=wv,l.capitalize=tu,l.ceil=ym,l.clamp=yv,l.clone=hy,l.cloneDeep=py,l.cloneDeepWith=dy,l.cloneWith=ly,l.conformsTo=fy,l.deburr=ru,l.defaultTo=Gv,l.divide=vm,l.endsWith=_v,l.eq=ft,l.escape=bv,l.escapeRegExp=Ev,l.every=Rg,l.find=xg,l.findIndex=Oc,l.findKey=Ky,l.findLast=Tg,l.findLastIndex=Ac,l.findLastKey=Hy,l.floor=mm,l.forEach=$c,l.forEachRight=Fc,l.forIn=By,l.forInRight=Wy,l.forOwn=Gy,l.forOwnRight=Jy,l.get=Dn,l.gt=gy,l.gte=yy,l.has=Qy,l.hasIn=$n,l.head=Nc,l.identity=Ve,l.includes=jg,l.indexOf=Tf,l.inRange=vv,l.invoke=tv,l.isArguments=or,l.isArray=k,l.isArrayBuffer=vy,l.isArrayLike=ke,l.isArrayLikeObject=me,l.isBoolean=my,l.isBuffer=Ht,l.isDate=wy,l.isElement=_y,l.isEmpty=by,l.isEqual=Ey,l.isEqualWith=Iy,l.isError=xn,l.isFinite=Py,l.isFunction=Dt,l.isInteger=Vc,l.isLength=es,l.isMap=Kc,l.isMatch=Sy,l.isMatchWith=Cy,l.isNaN=Oy,l.isNative=Ay,l.isNil=Ny,l.isNull=Ry,l.isNumber=Hc,l.isObject=ge,l.isObjectLike=ye,l.isPlainObject=ti,l.isRegExp=Tn,l.isSafeInteger=xy,l.isSet=Bc,l.isString=ts,l.isSymbol=Ge,l.isTypedArray=Sr,l.isUndefined=Ty,l.isWeakMap=Dy,l.isWeakSet=$y,l.join=jf,l.kebabCase=Iv,l.last=st,l.lastIndexOf=Mf,l.lowerCase=Pv,l.lowerFirst=Sv,l.lt=Fy,l.lte=Uy,l.max=wm,l.maxBy=_m,l.mean=bm,l.meanBy=Em,l.min=Im,l.minBy=Pm,l.stubArray=Ln,l.stubFalse=kn,l.stubObject=um,l.stubString=hm,l.stubTrue=lm,l.multiply=Sm,l.nth=qf,l.noConflict=tm,l.noop=qn,l.now=Zi,l.pad=Cv,l.padEnd=Ov,l.padStart=Av,l.parseInt=Rv,l.random=mv,l.reduce=zg,l.reduceRight=Vg,l.repeat=Nv,l.replace=xv,l.result=cv,l.round=Cm,l.runInContext=v,l.sample=Hg,l.size=Gg,l.snakeCase=Tv,l.some=Jg,l.sortedIndex=Bf,l.sortedIndexBy=Wf,l.sortedIndexOf=Gf,l.sortedLastIndex=Jf,l.sortedLastIndexBy=Yf,l.sortedLastIndexOf=Zf,l.startCase=$v,l.startsWith=Fv,l.subtract=Om,l.sum=Am,l.sumBy=Rm,l.template=Uv,l.times=pm,l.toFinite=$t,l.toInteger=z,l.toLength=Gc,l.toLower=jv,l.toNumber=nt,l.toSafeInteger=jy,l.toString=ee,l.toUpper=Mv,l.trim=qv,l.trimEnd=Lv,l.trimStart=kv,l.truncate=zv,l.unescape=Vv,l.uniqueId=fm,l.upperCase=Kv,l.upperFirst=Fn,l.each=$c,l.eachRight=Fc,l.first=Nc,Mn(l,function(){var e={};return wt(l,function(t,s){ie.call(l.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),l.VERSION=n,Xe(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),Xe(["drop","take"],function(e,t){W.prototype[e]=function(s){s=s===r?1:Pe(z(s),0);var c=this.__filtered__&&!t?new W(this):this.clone();return c.__filtered__?c.__takeCount__=De(s,c.__takeCount__):c.__views__.push({size:De(s,Te),type:e+(c.__dir__<0?"Right":"")}),c},W.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),Xe(["filter","map","takeWhile"],function(e,t){var s=t+1,c=s==_||s==V;W.prototype[e]=function(u){var p=this.clone();return p.__iteratees__.push({iteratee:U(u,3),type:s}),p.__filtered__=p.__filtered__||c,p}}),Xe(["head","last"],function(e,t){var s="take"+(t?"Right":"");W.prototype[e]=function(){return this[s](1).value()[0]}}),Xe(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");W.prototype[e]=function(){return this.__filtered__?new W(this):this[s](1)}}),W.prototype.compact=function(){return this.filter(Ve)},W.prototype.find=function(e){return this.filter(e).head()},W.prototype.findLast=function(e){return this.reverse().find(e)},W.prototype.invokeMap=H(function(e,t){return typeof e=="function"?new W(this):this.map(function(s){return Jr(s,e,t)})}),W.prototype.reject=function(e){return this.filter(Xi(U(e)))},W.prototype.slice=function(e,t){e=z(e);var s=this;return s.__filtered__&&(e>0||t<0)?new W(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==r&&(t=z(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},W.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},W.prototype.toArray=function(){return this.take(Te)},wt(W.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),c=/^(?:head|last)$/.test(t),u=l[c?"take"+(t=="last"?"Right":""):t],p=c||/^find/.test(t);u&&(l.prototype[t]=function(){var f=this.__wrapped__,g=c?[1]:arguments,m=f instanceof W,I=g[0],P=m||k(f),S=function(B){var G=u.apply(l,Mt([B],g));return c&&A?G[0]:G};P&&s&&typeof I=="function"&&I.length!=1&&(m=P=!1);var A=this.__chain__,$=!!this.__actions__.length,j=p&&!A,K=m&&!$;if(!p&&P){f=K?f:new W(this);var M=e.apply(f,g);return M.__actions__.push({func:Ji,args:[S],thisArg:r}),new tt(M,A)}return j&&K?e.apply(this,g):(M=this.thru(S),j?c?M.value()[0]:M.value():M)})}),Xe(["pop","push","shift","sort","splice","unshift"],function(e){var t=bi[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var u=arguments;if(c&&!this.__chain__){var p=this.value();return t.apply(k(p)?p:[],u)}return this[s](function(f){return t.apply(k(f)?f:[],u)})}}),wt(W.prototype,function(e,t){var s=l[t];if(s){var c=s.name+"";ie.call(_r,c)||(_r[c]=[]),_r[c].push({name:t,func:s})}}),_r[zi(r,ae).name]=[{name:"wrapper",func:r}],W.prototype.clone=zp,W.prototype.reverse=Vp,W.prototype.value=Kp,l.prototype.at=_g,l.prototype.chain=bg,l.prototype.commit=Eg,l.prototype.next=Ig,l.prototype.plant=Sg,l.prototype.reverse=Cg,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=Og,l.prototype.first=l.prototype.head,zr&&(l.prototype[zr]=Pg),l},vr=bp();Qt?((Qt.exports=vr)._=vr,Us._=vr):Re._=vr}).call(oi)})(oo,oo.exports);var lb=Object.defineProperty,pb=Object.defineProperties,db=Object.getOwnPropertyDescriptors,Yu=Object.getOwnPropertySymbols,fb=Object.prototype.hasOwnProperty,gb=Object.prototype.propertyIsEnumerable,Zu=(a,i,r)=>i in a?lb(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,ss=(a,i)=>{for(var r in i||(i={}))fb.call(i,r)&&Zu(a,r,i[r]);if(Yu)for(var r of Yu(i))gb.call(i,r)&&Zu(a,r,i[r]);return a},yb=(a,i)=>pb(a,db(i));function ut(a,i,r){let n;const o=ao(a);return i.rpcMap&&(n=i.rpcMap[o]),n||(n=`${hb}?chainId=eip155:${o}&projectId=${r}`),n}function ao(a){return a.includes("eip155")?Number(a.split(":")[1]):Number(a)}function Lh(a){return a.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function vb(a,i){const r=Object.keys(i.namespaces).filter(o=>o.includes(a));if(!r.length)return[];const n=[];return r.forEach(o=>{const h=i.namespaces[o].accounts;n.push(...h)}),n}function mb(a={},i={}){const r=Qu(a),n=Qu(i);return oo.exports.merge(r,n)}function Qu(a){var i,r,n,o;const h={};if(!Rr(a))return h;for(const[d,y]of Object.entries(a)){const b=Io(d)?[d]:y.chains,C=y.methods||[],D=y.events||[],x=y.rpcMap||{},q=as(d);h[q]=yb(ss(ss({},h[q]),y),{chains:zn(b,(i=h[q])==null?void 0:i.chains),methods:zn(C,(r=h[q])==null?void 0:r.methods),events:zn(D,(n=h[q])==null?void 0:n.events),rpcMap:ss(ss({},x),(o=h[q])==null?void 0:o.rpcMap)})}return h}function wb(a){return a.includes(":")?a.split(":")[2]:a}function _b(a){const i={};for(const[r,n]of Object.entries(a)){const o=n.methods||[],h=n.events||[],d=n.accounts||[],y=Io(r)?[r]:n.chains?n.chains:Lh(n.accounts);i[r]={chains:y,methods:o,events:h,accounts:d}}return i}const kh={},_e=a=>kh[a],Jn=(a,i)=>{kh[a]=i};class bb{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=_e("events"),this.client=_e("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||ut(`${this.name}:${i}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(Zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||ut(i,this.namespace);return typeof n>"u"?void 0:new Yt(new hr(n,_e("disableProviderPing")))}}class Eb{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=_e("events"),this.client=_e("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,r){const n=ao(i);if(!this.httpProviders[n]){const o=r||ut(`${this.name}:${n}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${n}`);this.setHttpProvider(n,o)}this.chainId=n,this.events.emit(Zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,r){const n=r||ut(`${this.name}:${i}`,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yt(new hr(n,_e("disableProviderPing")))}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const o=ao(r);i[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}async handleSwitchChain(i){var r,n;let o=i.request.params?(r=i.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class Ib{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=_e("events"),this.client=_e("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||ut(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(Zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||ut(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yt(new hr(n,_e("disableProviderPing")))}}class Pb{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=_e("events"),this.client=_e("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||ut(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(Zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||ut(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yt(new hr(n,_e("disableProviderPing")))}}class Sb{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=_e("events"),this.client=_e("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||this.getCardanoRPCUrl(i);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(Zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r);i[r]=this.createHttpProvider(r,n)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}getCardanoRPCUrl(i){const r=this.namespace.rpcMap;if(r)return r[i]}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||this.getCardanoRPCUrl(i);return typeof n>"u"?void 0:new Yt(new hr(n,_e("disableProviderPing")))}}class Cb{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=_e("events"),this.client=_e("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||ut(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(Zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||ut(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yt(new hr(n,_e("disableProviderPing")))}}class Ob{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=_e("events"),this.client=_e("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||ut(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(Zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||ut(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yt(new hr(n,_e("disableProviderPing")))}}var Ab=Object.defineProperty,Rb=Object.defineProperties,Nb=Object.getOwnPropertyDescriptors,Xu=Object.getOwnPropertySymbols,xb=Object.prototype.hasOwnProperty,Tb=Object.prototype.propertyIsEnumerable,eh=(a,i,r)=>i in a?Ab(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,ns=(a,i)=>{for(var r in i||(i={}))xb.call(i,r)&&eh(a,r,i[r]);if(Xu)for(var r of Xu(i))Tb.call(i,r)&&eh(a,r,i[r]);return a},Yn=(a,i)=>Rb(a,Nb(i));class Ao{constructor(i){this.events=new yo,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Y.pino(Y.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Gu})),this.disableProviderPing=(i==null?void 0:i.disableProviderPing)||!1}static async init(i){const r=new Ao(i);return await r.initialize(),r}async request(i,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:ns({},i),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(i,r,n){this.request(i,n).then(o=>r(null,o)).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:Ee("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}removeListener(i,r){this.events.removeListener(i,r)}off(i,r){this.events.off(i,r)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(h=>{this.session=h,this.namespaces||(this.namespaces=_b(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==Mh)throw h;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,r){try{if(!this.session)return;const[n,o]=this.validateChain(i);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(cr(r)){for(const n of r)i.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ib.init({logger:this.providerOpts.logger||Gu,relayUrl:this.providerOpts.relayUrl||ab,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(r=>as(r)))];Jn("client",this.client),Jn("events",this.events),Jn("disableProviderPing",this.disableProviderPing),i.forEach(r=>{if(!this.session)return;const n=vb(r,this.session),o=Lh(n),h=mb(this.namespaces,this.optionalNamespaces),d=Yn(ns({},h[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new Eb({namespace:d});break;case"solana":this.rpcProviders[r]=new Ib({namespace:d});break;case"cosmos":this.rpcProviders[r]=new Pb({namespace:d});break;case"polkadot":this.rpcProviders[r]=new bb({namespace:d});break;case"cip34":this.rpcProviders[r]=new Sb({namespace:d});break;case"elrond":this.rpcProviders[r]=new Cb({namespace:d});break;case"multiversx":this.rpcProviders[r]=new Ob({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:r}=i,{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&cr(o)&&this.events.emit("accountsChanged",o.map(wb))}else n.name==="chainChanged"?this.onChainChanged(r.chainId):this.events.emit(n.name,n.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:r})=>{var n;const{namespaces:o}=r,h=(n=this.client)==null?void 0:n.session.get(i);this.session=Yn(ns({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:r})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",Yn(ns({},Ee("USER_DISCONNECTED")),{data:i.topic}))}),this.on(Zt.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var r;this.getProvider(i).updateNamespace((r=this.session)==null?void 0:r.namespaces[i])})}setNamespaces(i){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=i;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(i){const[r,n]=(i==null?void 0:i.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(d=>as(d)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=as(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,r=!1){var n;if(!this.namespaces)return;const[o,h]=this.validateChain(i);r||this.getProvider(o).setDefaultChain(h),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,r){this.client.core.storage.setItem(`${Ju}/${i}`,r)}async getFromStore(i){return await this.client.core.storage.getItem(`${Ju}/${i}`)}}const Db=Ao,$b="wc",Fb="ethereum_provider",Ub=`${$b}@2:${Fb}:`,jb="https://rpc.walletconnect.com/v1/",co=["eth_sendTransaction","personal_sign"],Mb=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],uo=["chainChanged","accountsChanged"],qb=["message","disconnect","connect"];var Lb=Object.defineProperty,kb=Object.defineProperties,zb=Object.getOwnPropertyDescriptors,th=Object.getOwnPropertySymbols,Vb=Object.prototype.hasOwnProperty,Kb=Object.prototype.propertyIsEnumerable,rh=(a,i,r)=>i in a?Lb(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,ai=(a,i)=>{for(var r in i||(i={}))Vb.call(i,r)&&rh(a,r,i[r]);if(th)for(var r of th(i))Kb.call(i,r)&&rh(a,r,i[r]);return a},ih=(a,i)=>kb(a,zb(i));function fs(a){return Number(a[0].split(":")[1])}function Zn(a){return`0x${a.toString(16)}`}function Hb(a){const{chains:i,optionalChains:r,methods:n,optionalMethods:o,events:h,optionalEvents:d,rpcMap:y}=a;if(!Qn(i))throw new Error("Invalid chains");const b={chains:i,methods:n||co,events:h||uo,rpcMap:ai({},i.length?{[fs(i)]:y[fs(i)]}:{})},C=h==null?void 0:h.filter(Z=>!uo.includes(Z)),D=n==null?void 0:n.filter(Z=>!co.includes(Z));if(!r&&!d&&!o&&!(C!=null&&C.length)&&!(D!=null&&D.length))return{required:i.length?b:void 0};const x=(C==null?void 0:C.length)&&(D==null?void 0:D.length)||!r,q={chains:[...new Set(x?b.chains.concat(r||[]):r)],methods:[...new Set(b.methods.concat(o!=null&&o.length?o:Mb))],events:[...new Set(b.events.concat(d||qb))],rpcMap:y};return{required:i.length?b:void 0,optional:r.length?q:void 0}}class Ro{constructor(){this.events=new Pt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Ub,this.on=(i,r)=>(this.events.on(i,r),this),this.once=(i,r)=>(this.events.once(i,r),this),this.removeListener=(i,r)=>(this.events.removeListener(i,r),this),this.off=(i,r)=>(this.events.off(i,r),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const r=new Ro;return await r.initialize(i),r}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,r){this.signer.sendAsync(i,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:r,optional:n}=Hb(this.rpc);try{const o=await new Promise(async(d,y)=>{var b;this.rpc.showQrModal&&((b=this.modal)==null||b.subscribeModal(C=>{!C.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(ih(ai({namespaces:ai({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:i==null?void 0:i.pairingTopic})).then(C=>{d(C)}).catch(C=>{y(new Error(C.message))})});if(!o)return;this.setChainIds(this.rpc.chains);const h=Hm(o.namespaces,[this.namespace]);this.setAccounts(h),this.events.emit("connect",{chainId:Zn(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:r}=i,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const r=parseInt(i);this.chainId=r,this.events.emit("chainChanged",Zn(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",ih(ai({},Wm("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const r=i.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Zn(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const r=this.parseChainId(i);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(i){const[r,n,o]=i.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(i){this.accounts=i.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var r,n;const o=(r=i==null?void 0:i.chains)!=null?r:[],h=(n=i==null?void 0:i.optionalChains)!=null?n:[],d=o.concat(h);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=o.length?(i==null?void 0:i.methods)||co:[],b=o.length?(i==null?void 0:i.events)||uo:[],C=(i==null?void 0:i.optionalMethods)||[],D=(i==null?void 0:i.optionalEvents)||[],x=(i==null?void 0:i.rpcMap)||this.buildRpcMap(d,i.projectId),q=(i==null?void 0:i.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(Z=>this.formatChainId(Z)),optionalChains:h.map(Z=>this.formatChainId(Z)),methods:y,events:b,optionalMethods:C,optionalEvents:D,rpcMap:x,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:q,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,r){const n={};return i.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?fs(this.rpc.chains):fs(this.rpc.optionalChains),this.signer=await Db.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await Km(()=>import("./index-b35b7913.js").then(o=>o.i),["assets/index-b35b7913.js","assets/index-f4b9899e.js","assets/index-034e208d.css"]);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(ai({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:r,optionalChains:n,rpcMap:o}=i;r&&Qn(r)&&(this.rpc.chains=r.map(h=>this.formatChainId(h)),r.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)})),n&&Qn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)}))}getRpcUrl(i,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[i])||`${jb}?chainId=eip155:${i}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(r=>this.parseAccount(r))}}const eE=Ro;export{eE as EthereumProvider,qb as OPTIONAL_EVENTS,Mb as OPTIONAL_METHODS,uo as REQUIRED_EVENTS,co as REQUIRED_METHODS,Ro as default};
